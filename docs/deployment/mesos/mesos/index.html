<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Mesos · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;&lt;strong&gt;Running Jobs&lt;/strong&gt;&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Mesos · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/"/><meta property="og:description" content="&lt;p&gt;&lt;strong&gt;Running Jobs&lt;/strong&gt;&lt;/p&gt;
"/><meta property="og:image" content="https://twister2.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/introduction" target="_self">Docs</a></li><li class=""><a href="/docs/download" target="_self">Download</a></li><li class=""><a href="http://twister2.org" target="_self">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Deployment</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/introduction">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/download">Download</a></li><li class="navListItem"><a class="navItem" href="/docs/quickstart">Quickstart</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Compiling</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/compiling/compile_overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/compiling/linux">Linux</a></li><li class="navListItem"><a class="navItem" href="/docs/compiling/macos">MacOS</a></li><li class="navListItem"><a class="navItem" href="/docs/compiling/generate-maven">Maven Artifacts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">App Development</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/concepts/api_overview">API Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/developing_twister2">Developing Applications</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/worker_api">Worker API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/tset_api">TSet API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/task_api">Task API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/op_api">Operator API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/windowing/windowing_api">Windowing API</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Deployment</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/deployment/docker/docker">Docker</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/kubernetes/kubernetes">Kubernetes</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/deployment/mesos/mesos">Mesos</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/slurm/slurm">Slurm</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/standalone/standalone">Standalone</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/job-submit">Job Submit</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/dashboard">Dashboard</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/logging">Logging</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Concepts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/concepts/concepts">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/distributed_runtime">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/par_ops">Operators</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/task-system/concept_task">Task System</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/data-access/data_access">Data Access</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Examples</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/examples/wordcount/wordcount">Word Count</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/collectives/comms/comm">Operators</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/collectives/task/task">Task</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/benchmark/benchmark">Benchmark</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/joins/join">Join</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/terasort/terasort">Tera Sort</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/windowing/windowing">Windowing</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/ml/kmeans/kmeans">K-Means</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/ml/svm/svm">SVM</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Developer Resources</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/developers/debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/docs/developers/devenv">IDE&#x27;s</a></li><li class="navListItem"><a class="navItem" href="/docs/developers/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/docs/developers/tests">Unit Tests</a></li><li class="navListItem"><a class="navItem" href="/docs/community/contributing">Contributing</a></li><li class="navListItem"><a class="navItem" href="/docs/community/mailing">Mailing Lists</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Versions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/release/versions">Versions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Resources</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/publications">Publications</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Mesos</h1></header><article><div><span><p><strong>Running Jobs</strong></p>
<p>In order to run twister2 jobs you should have a running Mesos cluster.</p>
<p><strong>Running HelloWorld Example</strong></p>
<p>Please first familiarize yourself with <a href="https://github.com/DSC-SPIDAL/twister2/blob/master/docs/quickstart.md">HelloWorld job</a>.
You can submit jobs to Mesos cluster by using twister2 executable:</p>
<pre><code class="hljs css language-bash">./bin/twister2
</code></pre>
<p>When submitting jobs to Mesos clusters, you need to specify the cluster
name as &quot;mesos&quot;. You can submit HelloWorld job in examples package
with 8 workers as:</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit mesos jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.basic.HelloWorld 8
</code></pre>
<p>If there is a problem with the job submission, the job submission client will
exit with a corresponding message printed to the screen. Otherwise, job
submission client finishes execution with success.</p>
<p><strong>Job Logs</strong></p>
<p>You can see the job output either from Mesos Dashboard website(usually it
is on maser ip:5050) or persistent logs. The workers in HelloWorld job
prints a log message and sleeps 1 minutes before exiting.</p>
<p>You can view the log files in persistent storage if persistent storage is
enabled. Details can be found here on <a href="https://github.com/DSC-SPIDAL/twister2/blob/master/docs/deployment/mesos/twister2-mesos-install.md">installation
document</a>.</p>
<p><strong>Terminating a Running Job</strong></p>
<p>While some jobs automatically complete when they finish execution (ex:
batch jobs). Some other jobs may continually run (ex: streaming jobs).
Some jobs may also stuck or take a long time to finish. If we want to
terminate a running job, we can use twister2 command with the job name:</p>
<pre><code class="hljs css language-bash">./bin/twister2 <span class="hljs-built_in">kill</span> mesos jobname
</code></pre>
<p><strong>Twister2 Mesos Installation</strong></p>
<p>In order to use Mesos, you have to install it on the machines that you
want to use. One of the nodes will be the Mesos master and the others
will be Mesos agents. In order to run Mesos in your cluster, you need to
have Zookeeper running somewhere. Please refer to Mesos and Zookeeper
webpages for more information on installing them.</p>
<p>To compile  and install Twister2 on a machine, please follow the steps
in <a href="/docs/compiling/compile_overview">compiling document</a>.
You may also check <a href="/docs/developers/devenv">developer
document</a> for
setting up IDEs.</p>
<p>Here are the few things you need to do to run Twister2 jobs on Mesos
clusters.</p>
<p><strong>Persistent Storage Settings</strong></p>
<p>Twister2 expects that either a Persistent Storage Provisioner or
statically configured PersistentVolume exists in the cluster.  Our Mesos
system uses NFS for persistent storage to store logs and outputs of
twister2 jobs.</p>
<p>You have to set the following parameters in client.yaml config file in
order to use NFS.</p>
<pre><code class="hljs"># nfs server address
nfs.server.address: &quot;149.165.150.81&quot;

# nfs server path
nfs.server.path: &quot;/nfs/shared-mesos/twister2&quot;
</code></pre>
<p><strong>Job Package Uploader Settings</strong></p>
<p>When users submit a job to Mesos master, they first need to transfer the
job package to workers. Submitting client packs all job related files
into a tar file. This archive files needs to be transferred to each
worker that will be started. This transfer is done through a web server
in Mesos.</p>
<p>To do this there should be a web server running in the cluster. In
addition, job submitting client must have write permission to that
directory. Workers download the job package from this web server. You
need to specify the web server directory and address information
the uploader.yaml file.</p>
<pre><code class="hljs"># the directory where the file will be uploaded, make sure the user has the necessary permissions
# to upload the file here.
twister2.uploader.directory: &quot;/var/www/html/twister2/mesos/&quot;
twister2.uploader.directory.repository: &quot;/var/www/html/twister2/mesos/&quot;
# This is the scp command options that will be used by the uploader, this can be used to
# specify custom options such as the location of ssh keys.
twister2.uploader.scp.command.options: &quot;--chmod=+rwx&quot;
# The scp connection string sets the remote user name and host used by the uploader.
twister2.uploader.scp.command.connection: &quot;root@149.165.150.81&quot;
# The ssh command options that will be used when connecting to the uploading host to execute
# command such as delete files, make directories.
twister2.uploader.ssh.command.options: &quot;&quot;
# The ssh connection string sets the remote user name and host used by the uploader.
twister2.uploader.ssh.command.connection: &quot;root@149.165.150.81&quot;
</code></pre>
<p><strong>Enabling Docker Support</strong></p>
<p>You need to enable Docker support on Mesos to use this container. Run
the following command to enable Docker support on agents.</p>
<pre><code class="hljs">sh -c &quot;echo 'docker,mesos' &gt; /etc/mesos-slave/containerizers&quot;
</code></pre>
<p>**Docker setup **</p>
<pre><code class="hljs">sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    software-properties-common

curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
sudo add-apt-repository \
   &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable&quot;
sudo apt-get update
sudo apt-get install docker-ce
</code></pre>
<p>The following is an example init file for the Docker container.</p>
<pre><code class="hljs">cd twister2
wget 149.165.150.81:8082/twister2/mesos/twister2-core.tar.gz
wget 149.165.150.81:8082/twister2/mesos/twister2-job.tar.gz

echo &quot;starting sshd&quot;
/usr/sbin/sshd -D &amp;

if [ ! -f twister2-core.tar.gz ]; then 
    echo &quot;file not found. Probably could not download the file&quot;
else
    tar xvf twister2-core.tar.gz
    tar xvf twister2-job.tar.gz
    echo &quot;files fetched and unpacked&quot;
    java -cp twister2-core/lib/*:twister2-job/libexamples-java.jar:/customJars/* $CLASS_NAME
fi

sleep infinity
return_code=$?

echo -n &quot;$return_code&quot; &gt; /dev/termination-log
exit $return_code
</code></pre>
<p><strong>Docker Swarm Installation</strong></p>
<p>Make sure the Docker Engine daemon is started on the host machines.</p>
<p>Open a terminal and ssh into the machine where you want to run your
manager node. This tutorial uses a machine named manager1. If you use
Docker Machine, you can connect to it via SSH using the following
command:</p>
<p><code>$ docker-machine ssh manager1</code></p>
<p>Run the following command to create a new swarm:</p>
<p><code>docker swarm init --advertise-addr &lt;MANAGER-IP&gt;</code></p>
<p><strong>Note:</strong> If you are using Docker for Mac or Docker for Windows to test
single-node swarm, simply run docker swarm init with no arguments. There
is no need to specify --advertise-addr in this case.</p>
<p>The following command creates a swarm on the manager1 machine:</p>
<p><code>$ docker swarm init --advertise-addr 192.168.99.100</code></p>
<p>Swarm initialized: current node (dxn1zf6l61qsb1josjja83ngz) is now a
manager.</p>
<p>To add a worker to this swarm, run the following command:</p>
<pre><code class="hljs">docker swarm join \
    --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \
    192.168.99.100:2377
</code></pre>
<p>To add a manager to this swarm, run \'docker swarm join-token manager\'
and follow the instructions.</p>
<p>To check joined node:</p>
<p><code>docker node ls</code></p>
<p><img src="dockernode.png" alt="docker node"></p>
<p><strong>Creating Overlay Network on Docker Swarm</strong></p>
<p>To create an overlay network on Swarm, following command should be
runned on swarm master.</p>
<p><code>docker network create -d overlay --attachable &lt;network-name&gt;</code></p>
<p>To see Docker networks:</p>
<p><code>docker network ls</code></p>
<p><img src="dockernetwork.png" alt="docker network"></p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/deployment/kubernetes/kubernetes"><span class="arrow-prev">← </span><span>Kubernetes</span></a><a class="docs-next button" href="/docs/deployment/slurm/slurm"><span>Slurm</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/docs/en/developing_twister2.html">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Indiana University</section></footer></div></body></html>