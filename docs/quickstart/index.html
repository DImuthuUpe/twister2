<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>First Application · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Lets look at how to setup Twister2 and run few examples. Lets start with a simple Twister2 job to spawn set of parallel workers and print a log."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="First Application · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/"/><meta property="og:description" content="Lets look at how to setup Twister2 and run few examples. Lets start with a simple Twister2 job to spawn set of parallel workers and print a log."/><meta property="og:image" content="https://twister2.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Getting Started</a></li><li class=""><a href="/docs/compiling/compile_overview" target="_self">Docs</a></li><li class=""><a href="/docs/examples/tset/hello_world" target="_self">Tutorial</a></li><li class=""><a href="/docs/examples/examples" target="_self">Examples</a></li><li class=""><a href="/docs/developers/debugging" target="_self">Contribute</a></li><li class=""><a href="/docs/download" target="_self">Download</a></li><li class=""><a href="/configs" target="_self">Configurations</a></li><li class=""><a href="/javadocs/index.html" target="_self">Java Docs</a></li><li class=""><a href="https://github.com/DSC-SPIDAL/twister2" target="_blank">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">First Application</h1></header><article><div><span><p>Lets look at how to setup Twister2 and run few examples. Lets start with a simple Twister2 job to spawn set of parallel workers and print a log.</p>
<h3><a class="anchor" aria-hidden="true" id="compiling-twister2"></a><a href="#compiling-twister2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Compiling Twister2</h3>
<p>First we need to compile Twister2. <a href="/docs/compiling/compile_overview">Compiling Twister2</a> explains the steps in detail. After building the code and
following the instructions in <a href="/docs/compiling/linux">Twister2 Distribution</a> you should have a extracted folder named <code>twister2-0.4.0</code>, this would be your twister2 home folder.</p>
<p>Here are the essential steps in compiling Twister2.</p>
<pre><code class="hljs css language-bash">wget https://github.com/DSC-SPIDAL/twister2/archive/0.4.0.tar.gz
tar -xvf twister2-0.4.0.tar.gz

<span class="hljs-built_in">cd</span> twister2-0.4.0
./build_linux.sh
</code></pre>
<p>The above command will install Twister2 along with system dependencies. You will need to give sudo
access to the script. It will take about 20 minutes to build Twister2 depending on the system
configuration.</p>
<p>The above command will build a twister2 distribution and we need to extract it.</p>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># the binary is created inside this package</span>
<span class="hljs-built_in">cd</span> bazel-bin/scripts/package
tar -xvf twister2-0.4.0.tar.gz
<span class="hljs-comment"># go inside the twister2 binary</span>
<span class="hljs-built_in">cd</span> twister2-0.4.0
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="starting-parallel-workers"></a><a href="#starting-parallel-workers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Starting parallel workers</h3>
<p>At the base of Twister2 is a resource manager that allocates resources for jobs. Unlike other big data projects that mixes different capabilities here, Twister2 resource manager only allocate resources and spawn set of parallel processes.</p>
<p>There is an example called HelloWorld.java included with Twister2 examples package. Note that it implements the IWorker interface, which is the entry point to any Twister2 job. In the main method of this class we submit a job to Twister2 with this HelloWorld class as the job class.</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">package</span> edu.iu.dsc.tws.examples.basic;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.logging.Level;
<span class="hljs-keyword">import</span> java.util.logging.Logger;

<span class="hljs-keyword">import</span> edu.iu.dsc.tws.api.JobConfig;
<span class="hljs-keyword">import</span> edu.iu.dsc.tws.api.Twister2Job;
<span class="hljs-keyword">import</span> edu.iu.dsc.tws.api.config.Config;
<span class="hljs-keyword">import</span> edu.iu.dsc.tws.api.exceptions.TimeoutException;
<span class="hljs-keyword">import</span> edu.iu.dsc.tws.api.resource.IPersistentVolume;
<span class="hljs-keyword">import</span> edu.iu.dsc.tws.api.resource.IVolatileVolume;
<span class="hljs-keyword">import</span> edu.iu.dsc.tws.api.resource.IWorker;
<span class="hljs-keyword">import</span> edu.iu.dsc.tws.api.resource.IWorkerController;
<span class="hljs-keyword">import</span> edu.iu.dsc.tws.proto.jobmaster.JobMasterAPI;
<span class="hljs-keyword">import</span> edu.iu.dsc.tws.proto.utils.WorkerInfoUtils;
<span class="hljs-keyword">import</span> edu.iu.dsc.tws.rsched.core.ResourceAllocator;
<span class="hljs-keyword">import</span> edu.iu.dsc.tws.rsched.job.Twister2Submitter;

<span class="hljs-comment">/**
 * This is a Hello World example of Twister2. This is the most basic functionality of Twister2,
 * where it spawns set of parallel workers.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorld</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IWorker</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = Logger.getLogger(HelloWorld<span class="hljs-class">.<span class="hljs-keyword">class</span>.<span class="hljs-title">getName</span>())</span>;

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Config config, <span class="hljs-keyword">int</span> workerID,
                      IWorkerController workerController,
                      IPersistentVolume persistentVolume, IVolatileVolume volatileVolume)</span> </span>{
    <span class="hljs-comment">// lets retrieve the configuration set in the job config</span>
    String helloKeyValue = config.getStringValue(<span class="hljs-string">"hello-key"</span>);

    <span class="hljs-comment">// lets do a log to indicate we are running</span>
    LOG.log(Level.INFO, String.format(<span class="hljs-string">"Hello World from Worker %d; there are %d total workers "</span>
            + <span class="hljs-string">"and I got a message: %s"</span>, workerID,
        workerController.getNumberOfWorkers(), helloKeyValue));

    List&lt;JobMasterAPI.WorkerInfo&gt; workerList = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">try</span> {
      workerList = workerController.getAllWorkers();
    } <span class="hljs-keyword">catch</span> (TimeoutException timeoutException) {
      LOG.log(Level.SEVERE, timeoutException.getMessage(), timeoutException);
      <span class="hljs-keyword">return</span>;
    }
    String workersStr = WorkerInfoUtils.workerListAsString(workerList);
    LOG.info(<span class="hljs-string">"All workers have joined the job. Worker list: \n"</span> + workersStr);

    <span class="hljs-keyword">try</span> {
      LOG.info(<span class="hljs-string">"I am sleeping for 1 minute and then exiting."</span>);
      Thread.sleep(<span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);
      LOG.info(<span class="hljs-string">"I am done sleeping. Exiting."</span>);
    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
      LOG.severe(<span class="hljs-string">"Thread sleep interrupted."</span>);
    }

  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
    <span class="hljs-comment">// lets take number of workers as an command line argument</span>
    <span class="hljs-keyword">int</span> numberOfWorkers = <span class="hljs-number">4</span>;
    <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">1</span>) {
      numberOfWorkers = Integer.valueOf(args[<span class="hljs-number">0</span>]);
    }

    <span class="hljs-comment">// first load the configurations from command line and config files</span>
    Config config = ResourceAllocator.loadConfig(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());

    <span class="hljs-comment">// lets put a configuration here</span>
    JobConfig jobConfig = <span class="hljs-keyword">new</span> JobConfig();
    jobConfig.put(<span class="hljs-string">"hello-key"</span>, <span class="hljs-string">"Twister2-Hello"</span>);

    Twister2Job twister2Job = Twister2Job.newBuilder()
        .setJobName(<span class="hljs-string">"hello-world-job"</span>)
        .setWorkerClass(HelloWorld<span class="hljs-class">.<span class="hljs-keyword">class</span>)
        .<span class="hljs-title">addComputeResource</span>(2, 1024, <span class="hljs-title">numberOfWorkers</span>)
        .<span class="hljs-title">setConfig</span>(<span class="hljs-title">jobConfig</span>)
        .<span class="hljs-title">build</span>()</span>;
    <span class="hljs-comment">// now submit the job</span>
    Twister2Submitter.submitJob(twister2Job, config);
  }
}
</code></pre>
<p>Now lets run this class using command line. Lets go inside the twister2 distribution and execute the following command from twister2 root directory. Go into the
<code>twister2-0.4.0</code> directory before executing the commands below.</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.basic.HelloWorld 8
</code></pre>
<p>When this runs it will print a logs like this in to the console.</p>
<pre><code class="hljs css language-bash">[INFO] edu.iu.dsc.tws.examples.basic.HelloWorld: Hello World from Worker 2; there are 8 other workers and I got a configuration value Twister2-Hello
</code></pre>
<p>It is that simple!</p>
<p>The above command submits a job class using the standalone mode. The command accepts the jar file containing the main class and the class name to run.</p>
<h3><a class="anchor" aria-hidden="true" id="communicating-between-workers"></a><a href="#communicating-between-workers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Communicating between workers</h3>
<p>Okay, the next step is to communicate between the workers we have created. There are many examples in Twister2 that use communication among workers and some of these can be found inside the directory</p>
<pre><code class="hljs css language-bash">examples/src/java/edu/iu/dsc/tws/examples/comms
</code></pre>
<p>You can run them with a simple command such as</p>
<pre><code class="hljs css language-text">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -op "reduce" -stages 8,1 -workers 4
</code></pre>
<p>Now, lets focus on a simple communication example where we try to do a word count.</p>
<h3><a class="anchor" aria-hidden="true" id="word-count-example"></a><a href="#word-count-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Word Count Example</h3>
<p>Lets look at a word count example. This is a standard example in every other big data system. The code related to example can be found in</p>
<pre><code class="hljs css language-bash">examples/src/java/edu/iu/dsc/tws/examples/batch/wordcount/task
</code></pre>
<p>We are using a Keyed Reduce communication operation to calculate the global counts of words, which are emitted from parallel workers.</p>
<p>The example has three main classes.</p>
<p>WordCountWorker that implements the IWorker interface and runs the code.</p>
<pre><code class="hljs css language-java">edu.iu.dsc.tws.examples.batch.wordcount.task.WordCountWorker
</code></pre>
<p>BatchWordSource, where we use a thread to generate words and put them into the communication.</p>
<pre><code class="hljs css language-java">edu.iu.dsc.tws.examples.batch.wordcount.task.BatchWordSouce
</code></pre>
<p>WordAggregator, where it receives the counts of the words.</p>
<pre><code class="hljs css language-java">edu.iu.dsc.tws.examples.batch.wordcount.task.WordAggregator
</code></pre>
<p>The WordCountWorker sets up communications and task ids. Then it sets up the communication operation.</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">this</span>.taskPlan = Utils.createStageTaskPlan(
    cfg, resources, taskStages, workerList);

setupTasks();
setupNetwork(workerController, resources);

<span class="hljs-comment">// create the communication</span>
wordAggregator = <span class="hljs-keyword">new</span> WordAggregator();
keyGather = <span class="hljs-keyword">new</span> BKeyedReduce(channel, taskPlan, sources, destinations,
    <span class="hljs-keyword">new</span> ReduceOperationFunction(Op.SUM, MessageType.INTEGER),
    wordAggregator, MessageType.OBJECT, MessageType.INTEGER, <span class="hljs-keyword">new</span> HashingSelector());
</code></pre>
<p>We send the messages through this communication operation using the code in BatchWordSource</p>
<pre><code class="hljs css language-java">String word = sampleWords.get(random.nextInt(sampleWords.size()));
<span class="hljs-comment">// lets try to process if send doesn't succeed</span>
<span class="hljs-keyword">while</span> (!operation.reduce(taskId, word, <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[]{<span class="hljs-number">1</span>}, <span class="hljs-number">0</span>)) {
  operation.progress();
}
</code></pre>
<p>We send 1 as the word count and it will be summed up for the each word.</p>
<p>We receive the final word counts as an iteration in the WordAggregator.</p>
<pre><code class="hljs css language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">receive</span><span class="hljs-params">(<span class="hljs-keyword">int</span> target, Iterator&lt;Object&gt; it)</span> </span>{
<span class="hljs-keyword">while</span> (it.hasNext()) {
  Object next = it.next();
  <span class="hljs-keyword">if</span> (next <span class="hljs-keyword">instanceof</span> ImmutablePair) {
    ImmutablePair kc = (ImmutablePair) next;
    LOG.log(Level.INFO, String.format(<span class="hljs-string">"%d Word %s count %s"</span>,
        target, kc.getKey(), ((<span class="hljs-keyword">int</span>[]) kc.getValue())[<span class="hljs-number">0</span>]));
  }
}
isDone = <span class="hljs-keyword">true</span>;
<span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="running-wordcount"></a><a href="#running-wordcount" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running WordCount</h3>
<p>Here is the command to run this example</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.batch.wordcount.task.WordCountJob
</code></pre>
<p>It will output the words and their counts on the console and below is an small sample.</p>
<pre><code class="hljs css language-bash">[2019-08-22 16:41:22 -0400] [INFO] [worker-3] [main] edu.iu.dsc.tws.examples.batch.wordcount.task.WordCountJob: 100003 Word aw count 1  
[2019-08-22 16:41:22 -0400] [INFO] [worker-3] [main] edu.iu.dsc.tws.examples.batch.wordcount.task.WordCountJob: 100003 Word z count 5  
[2019-08-22 16:41:22 -0400] [INFO] [worker-3] [main] edu.iu.dsc.tws.examples.batch.wordcount.task.WordCountJob: 100003 Word DWm count 3  
[2019-08-22 16:41:22 -0400] [INFO] [worker-3] [main] edu.iu.dsc.tws.examples.batch.wordcount.task.WordCountJob: 100003 Word wU count 1  
[2019-08-22 16:41:22 -0400] [INFO] [worker-3] [main] edu.iu.dsc.tws.examples.batch.wordcount.task.WordCountJob: 100003 Word Ge count 1  
[2019-08-22 16:41:22 -0400] [INFO] [worker-3] [main] edu.iu.dsc.tws.examples.batch.wordcount.task.WordCountJob: 100003 Word yW count 2  
[2019-08-22 16:41:22 -0400] [INFO] [worker-3] [main] edu.iu.dsc.tws.rsched.schedulers.standalone.MPIWorker: Worker finished executing - 3  
[2019-08-22 16:41:22 -0400] [INFO] [-] [JM] edu.iu.dsc.tws.master.server.JobMaster: All 4 workers have completed. JobMaster is stopping.  
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/docs/en/concepts/api_overview">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2020 Indiana University</section></footer></div></body></html>