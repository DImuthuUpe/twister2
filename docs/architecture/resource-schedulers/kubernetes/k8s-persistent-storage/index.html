<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>architecture/resource-schedulers/kubernetes/k8s-persistent-storage · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;k8s-persistent-storage&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#k8s-persistent-storage&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;K8s Persistent Storage&lt;/h1&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="architecture/resource-schedulers/kubernetes/k8s-persistent-storage · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/twister2/"/><meta property="og:description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;k8s-persistent-storage&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#k8s-persistent-storage&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;K8s Persistent Storage&lt;/h1&gt;
"/><meta property="og:image" content="https://twister2.org/twister2/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/twister2/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/twister2/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/twister2/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/twister2/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/twister2/js/scrollSpy.js"></script><link rel="stylesheet" href="/twister2/css/main.css"/><script src="/twister2/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/twister2/"><img class="logo" src="/twister2/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/twister2/docs/introduction" target="_self">Docs</a></li><li class=""><a href="/twister2/docs/download" target="_self">Download</a></li><li class=""><a href="http://twister2.org" target="_self">GitHub</a></li><li class=""><a href="/twister2/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">architecture/resource-schedulers/kubernetes/k8s-persistent-storage</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="k8s-persistent-storage"></a><a href="#k8s-persistent-storage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>K8s Persistent Storage</h1>
<p>Kubernetes provides <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">persistent storage</a> support by using any one of the supported distributed file systems. Some of the supported file systems are: gcePersistentDisk, awsElasticBlockStore, Cinder, glusterfs, rbd, Azure File, Azure Disk, Portworx, NFS.</p>
<p>We tested Twister2 persistent storage support with Network File System (NFS). Other file systems should also work. We installed an NFS server in one of the cluster servers. We also deployed the <a href="https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client">NFS-Client provisioner</a>. It handles dynamic PersistentVolume creation and deletions. NFS-Client provisioner runs as a separate deployment in the cluster.</p>
<p>We create a separate PersistentVolumeClaim object for each job.<br>
PersistentVolume creation is handled dynamically by the provisioner. A separate persistent directory is created for each job by the provisioner in our NFS server.</p>
<p>Twister2 should also work with static PersistentVolumes. However, it is much more convenient to use a dynamic provisioner.</p>
<p>Each twister2 pod attaches itself to the shared NFS directory. Each pod mounts to the persistent volume as:</p>
<pre><code class="hljs css language-text">/persistent 
</code></pre>
<p>Since the provisioner provides a separate directory for each PersistentVolume, we do not create a separate job directory under this directory. A separate logs directory is also created for persistent log files.</p>
<h2><a class="anchor" aria-hidden="true" id="configuration-settings"></a><a href="#configuration-settings" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration Settings</h2>
<p><strong>Persistent Storage Class</strong>: Cluster administrators provide a StorageClass object to dynamically create PersistentVolumes. Its name must be provided as a parameter in the configuration files. Parameter name:</p>
<pre><code class="hljs css language-text"> kubernetes.persistent.storage.class
</code></pre>
<p><strong>Persistent Volume Sizes</strong>: A parameter determines the size of the persistent volume on each worker. It is called:</p>
<pre><code class="hljs css language-text">persistent.volume.per.worker
</code></pre>
<p>When persistent.volume.per.worker value is zero, twister2 does not initialize persistent storage. If a cluster does not have persistent storage support, this value must be set to zero.</p>
<p><strong>Access Modes</strong>: Pods can have read/write access to the persistent volume. By default pods have ReadWriteMany access. It can be changed from the configuration files by using the configuration parameter:</p>
<pre><code class="hljs css language-text">kubernetes.storage.access.mode
</code></pre>
<p>The options are ReadWriteMany, ReadWriteOnce and ReadOnlyMany. In the case of ReadWriteOnce, only one pod can write. In the case of ReadOnlyMany, all pods can only read.</p>
<h2><a class="anchor" aria-hidden="true" id="design-issues"></a><a href="#design-issues" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Design Issues</h2>
<p>Kubernetes has two constructs related to persistent volumes: PersistentVolume and PersistentVolumeClaim.<br>
PersistentVolumes are created either by administrators statically or by provisioners dynamically. Twister2 should work in both cases. We assume that either a storage provisioner is deployed in the cluster or a static PersistentVolume is created for each job. We create one PersistentVolumeClaim instance for each job. All pods in the job attach to the same PersistentVolumeClaim.</p>
<p>When the job has completed, we delete the PersistentVolumeClaim object. The provisioner deletes the PersistentVolume object automatically. When the PersistentVolume object is deleted, depending on the storage retain policy of the provisioner, created files may be deleted. If the job files in the persistent storage are deleted after the job has completed, retain policy of the provisioner needs to be changed from “Delete” to “Retain”.</p>
<p>The name of the PersistentVolumeClaim object for a job is constructed by using the job name as a suffix.</p>
<h2><a class="anchor" aria-hidden="true" id="persistentvolume-interface-ipersistentvolume"></a><a href="#persistentvolume-interface-ipersistentvolume" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PersistentVolume Interface: IPersistentVolume</h2>
<p>An interface is added to Twister2 package for letting workers access persistent volumes. The interface is:</p>
<p><a href="https://github.com/DSC-SPIDAL/twister2/tree/df68933f416e28f8cbd95c1ffed285a86f017093/twister2/common/src/java/edu/iu/dsc/tws/common/worker/IPersistentVolume.java">edu.iu.dsc.tws.common.worker.IPersistentVolume</a></p>
<p>The interface has methods for two directories: job directory and worker directory. Job directory is shared among all workers in a job. Worker directory is created for each worker. In addition, it returns the persistent log file name for this worker.</p>
<p>The methods are:</p>
<pre><code class="hljs css language-text">String getJobDirPath();
String getWorkerDirPath();
boolean jobDirExists();
boolean workerDirExists();
File getJobDir();
File getWorkerDir();
String getLogFileName();
</code></pre>
<p>IPersistentVolume interface is implemented in the class:<br>
<a href="https://github.com/DSC-SPIDAL/twister2/tree/df68933f416e28f8cbd95c1ffed285a86f017093/twister2/resource-scheduler/src/java/edu/iu/dsc/tws/rsched/schedulers/k8s/worker/K8sPersistentVolume.java">edu.iu.dsc.tws.rsched.schedulers.k8s.worker.K8sPersistentVolume</a></p>
<p>An instance of this class is passed to the IWorker classes. Therefore, workers will be able to use the provided persistent storage.</p>
<h2><a class="anchor" aria-hidden="true" id="limitations-and-future-works"></a><a href="#limitations-and-future-works" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Limitations and Future Works</h2>
<p>Persistent storage is only implemented and tested for NFS. Kubernetes supports many other distributed storage systems. Persistent storage support for other storage systems need to be added. Particularly, the support for Amazon AWS, Google GCE, Azure Disk Storage, etc. can be added.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#configuration-settings">Configuration Settings</a></li><li><a href="#design-issues">Design Issues</a></li><li><a href="#persistentvolume-interface-ipersistentvolume">PersistentVolume Interface: IPersistentVolume</a></li><li><a href="#limitations-and-future-works">Limitations and Future Works</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/twister2/" class="nav-home"><img src="/twister2/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/twister2/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/twister2/docs/en/developing_twister2.html">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/twister2/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Indiana University</section></footer></div></body></html>