<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>architecture/resource-schedulers/kubernetes/k8s-worker-binding-mapping · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;k8s-worker-binding-mapping&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#k8s-worker-binding-mapping&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;K8s Worker Binding Mapping&lt;/h1&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="architecture/resource-schedulers/kubernetes/k8s-worker-binding-mapping · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/"/><meta property="og:description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;k8s-worker-binding-mapping&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#k8s-worker-binding-mapping&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;K8s Worker Binding Mapping&lt;/h1&gt;
"/><meta property="og:image" content="https://twister2.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Docs</a></li><li class=""><a href="/docs/download" target="_self">Download</a></li><li class=""><a href="https://github.com/DSC-SPIDAL/twister2" target="_self">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">architecture/resource-schedulers/kubernetes/k8s-worker-binding-mapping</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="k8s-worker-binding-mapping"></a><a href="#k8s-worker-binding-mapping" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>K8s Worker Binding Mapping</h1>
<p>Worker binding is the process of binding workers to CPU cores. Bounded workers are prevented to be moved from one core to the other during their lifetimes. They finish the execution in the core that they are started.</p>
<p>Worker mapping is the process of assigning workers to nodes around the cluster. Some jobs may need to run in some specific machines. Some machines may have special hardware such as GPUs or fast SSD disks. Or some nodes may have special software. Therefore, some jobs may need to run on some specific machines. On the contrary, some jobs may want to NOT run on some machines. They may run in any machine but some of them. Worker mapping handles the distribution of workers to nodes in the cluster.</p>
<h2><a class="anchor" aria-hidden="true" id="worker-binding"></a><a href="#worker-binding" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Worker Binding</h2>
<p>Kubernetes allows binding of pods to CPU cores. It is called static binding. When a pod is started with static binding, that pod has exclusive ownership of the assigned core(s). Therefore, this pod is not moved to any other core during its lifetime.</p>
<p>When CPUs are requested for workers with static binding, CPUs per worker has to be an integer. When a pod is statically bounded to a core, it can not have fractional ownership of that core. It has to have the total access to the core. However, one worker (container) can have more than one cores, but not fractional cores. Kubernetes use <a href="https://www.kernel.org/doc/Documentation/cgroup-v1/cpusets.txt">Linux CPUSETS</a> to implement exclusive binding of pods to cores.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration-parameters"></a><a href="#configuration-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration Parameters</h3>
<p>A boolean configuration parameter is added to the configuration files. If its value is set to “true”, static binding is performed. Otherwise, workers are not bounded to cores. They may be moved during their lifetimes to other cores. The configuration parameter is:</p>
<pre><code class="hljs css language-text">  kubernetes.bind.worker.to.cpu
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="binding-all-workers"></a><a href="#binding-all-workers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Binding All Workers</h3>
<p>When worker binding is requested, all workers in that job is bound to their cores. There is no binding for only some workers in a Twister2 job. Either all workers are bounded or none.</p>
<h3><a class="anchor" aria-hidden="true" id="binding-inefficiency"></a><a href="#binding-inefficiency" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Binding Inefficiency</h3>
<p>Worker binding should be used with caution. Since only the assigned worker can use the cores, those cores may go idle sometimes and no other pods in the system can use them during their lifetime. Unnecessary use of worker binding may result in less than optimal utilization of computing resources.</p>
<h2><a class="anchor" aria-hidden="true" id="worker-to-nodes-mapping"></a><a href="#worker-to-nodes-mapping" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Worker to Nodes Mapping</h2>
<p>Kubernetes provides some mechanisms to map pods to nodes in a cluster. When submitting a job, users can request that worker pods to be started in nodes with some labels. Or they can request that pods not to be started in some nodes with some labels. In any case, pod assignment to nodes are handled by using labels.</p>
<p>In the first step, node labels are created for cluster machines. In the second step, users request their worker pods to be started based on those labels. Node labeling is performed by using kubectl command line tool. We assume that node labeling is performed prior to creating Twister2 jobs. The format of the label creation command is as follows:</p>
<blockquote>
<p>kubectl label nodes &lt;node-name&gt; &lt;label-key&gt;=&lt;label-value&gt;</p>
</blockquote>
<p><strong>Predefined Labels</strong>: There are also some predefined labels in Kubernetes for each node. Users can request mapping based on these labels also. Some of these labels are as follows:</p>
<ul>
<li>kubernetes.io/hostname,</li>
<li>beta.kubernetes.io/os,</li>
<li>beta.kubernetes.io/arch.</li>
</ul>
<p>The primary reason for requesting workers to be located in some nodes is that not all machine nodes in a cluster are the same. Some nodes might have different hardware such as faster disks, faster CPUs, or extra hardware such as GPUs, they might have extra installed software such as databases. These machines are first labeled for these features and then users submit the jobs for their workers to be scheduled on the requested nodes.</p>
<h3><a class="anchor" aria-hidden="true" id="worker-mapping-implementation"></a><a href="#worker-mapping-implementation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Worker Mapping Implementation</h3>
<p>When requesting pod placement to nodes, users provide three types of data:</p>
<ul>
<li>label-key</li>
<li>operator</li>
<li>label-values</li>
</ul>
<p>There are currently six operators:</p>
<ul>
<li>In, NotIn, Exists, DoesNotExist, Gt, Lt.</li>
</ul>
<p>Two of the operators check for equality:</p>
<ul>
<li>In and NotIn</li>
</ul>
<p>Two of the operators check for the existence of the given labels in nodes (They don’t check the values of the keys):</p>
<ul>
<li>Exists, DoesNotExist</li>
</ul>
<p>Two of the operators check for numerical comparison:</p>
<ul>
<li>Gt (greater than) and Lt (less than)</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="configuration-parameters-1"></a><a href="#configuration-parameters-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration Parameters</h3>
<p>In our Twister2 implementation, we allow users to specify these three parameters in configuration files. We have 4 configuration parameters. First one shows whether the user wants worker to nodes mapping. The other three determines the mapping parameters:</p>
<pre><code class="hljs css language-text">kubernetes.worker.to.node.mapping: true or false
kubernetes.worker.mapping.key: “key”
kubernetes.worker.mapping.operator: “op”
kubernetes.worker.mapping.values: [‘list’ ‘of’ ‘values’]
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="example-1"></a><a href="#example-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example 1:</h3>
<p>Let’s assume that we have a cluster with 10 nodes. 4 of them have GPUs and they are labeled as “extra-hardware=gpu”. We want to start our workers in gpu installed nodes. Users specify the worker mapping parameters as:</p>
<pre><code class="hljs css language-text">kubernetes.worker.to.node.mapping: true
kubernetes.worker.mapping.key:  “extra-hardware”
kubernetes.worker.mapping.operator:  “In”
kubernetes.worker.mapping.values: [‘gpu’]
</code></pre>
<p>This makes sure that the workers are started only in one of those 4 gpu installed nodes. Since values can have more than one value, it is given as a list of strings.</p>
<p>As another example, the user might want to start the workers in non-gpu installed nodes. In that case, configuration values will be:</p>
<pre><code class="hljs css language-text">kubernetes.worker.to.node.mapping: true
kubernetes.worker.mapping.key:  “extra-hardware”
kubernetes.worker.mapping.operator: “NotIn”
kubernetes.worker.mapping.values: [‘gpu’]
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="example-2"></a><a href="#example-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example 2:</h3>
<p>We can also use default keys when requesting worker mapping to nodes. Let’s use node name labels. Let’s assume that the nodes have names:<br>
node01, node02, node03, … , node9.</p>
<p>We can request that the workers to be placed in one of three nodes such as node03, node04, node05. In this case, the configuration settings would be:</p>
<pre><code class="hljs css language-text">kubernetes.worker.to.node.mapping: true
kubernetes.worker.mapping.key:  "kubernetes.io/hostname"
kubernetes.worker.mapping.operator: “In”
kubernetes.worker.mapping.values: [‘node03’, ‘node04’, ‘node05’]
</code></pre>
<p>Or we can request that the workers not to be placed in one of those nodes:</p>
<pre><code class="hljs css language-text">kubernetes.worker.to.node.mapping: true
kubernetes.worker.mapping.key:  "kubernetes.io/hostname"
kubernetes.worker.mapping.operator: “NotIn”
kubernetes.worker.mapping.values: [‘node03’, ‘node04’, ‘node05’]
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="limitations"></a><a href="#limitations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Limitations</h3>
<p>Currently users can set only one set of configuration parameters when submitting a job. The user can not requests worker placements based on more than one label key. However, Kubernetes supports that feature. This feature may be added to Twister2.</p>
<h2><a class="anchor" aria-hidden="true" id="uniform-worker-mapping"></a><a href="#uniform-worker-mapping" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uniform Worker Mapping</h2>
<p>In addition to node affinity, Kubernetes also provides pod affinity mechanism. With this method, pods can be deployed with respect to the other pods running in the cluster. Instead of directly supporting this service, we implemented two specific cases of this service that distributes pods uniformly.</p>
<p><strong>all-same-node</strong>: When uniform worker mapping is requested with “all-same-node” value, all pods in that job are placed into the same node. This does not say anything about the node to be deployed. All it requires that all pods belonging to this job will be started on the same node. It can be any node in the cluster or any node that is determined by node mapping settings.</p>
<p><strong>all-separate-nodes</strong>: When uniform worker mapping is requested with “all-separate-nodes” value, all pods in that job are placed into separate nodes. Only one pod is placed into one node. If there are not enough nodes in the cluster, the job can not be started. However, this does not guarantee that only one worker will be running on each node, since there might be more than one worker in each pod. Pod placement applies to only pods but not directly to workers. If each pod runs only a single worker, then worker placement becomes equivalent to pod placement.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration-parameter"></a><a href="#configuration-parameter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration Parameter</h3>
<p>Configuration parameter for uniform worker mapping is:</p>
<pre><code class="hljs css language-text">kubernetes.worker.mapping.uniform
</code></pre>
<p>Its value can be: &quot;all-same-node&quot;, &quot;all-separate-nodes&quot;, &quot;none&quot;</p>
<p>By default, its value is &quot;none&quot;.</p>
<h2><a class="anchor" aria-hidden="true" id="using-worker-mapping-and-binding-settings-together"></a><a href="#using-worker-mapping-and-binding-settings-together" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using Worker Mapping and Binding Settings Together</h2>
<p>Worker mapping and uniform mapping can be used together. However, they should not conflict each other. They should complement each other.</p>
<p>For example, in the above cluster with 10 nodes and 4 of them having GPUs, one can specify both worker mapping and uniform mapping together. Let’s say, we want to run one pod on each GPU node. We can specify that workers to be started in GPU installed nodes only and they should be uniformly distributed with all-separate-nodes option. In this case, there can be at most 4 pods running in the job though. If we want to start more than 4 pods with the same settings, then the job can not be started.</p>
<p>Worker mapping and worker binding can be used together also. They do not conflict each other. However, there must be enough resources for worker binding.</p>
<h2><a class="anchor" aria-hidden="true" id="future-works"></a><a href="#future-works" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Future Works</h2>
<p>Pod affinity support can be improved. More cases can be added. For example, the pods of a job can be requested to run only with some other pods. Let’s assume that there are four pods running in the cluster for a database server, we can start one pod next to each database server. Or, we can say that our pods should not run in any node that is running this database pods.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#worker-binding">Worker Binding</a><ul class="toc-headings"><li><a href="#configuration-parameters">Configuration Parameters</a></li><li><a href="#binding-all-workers">Binding All Workers</a></li><li><a href="#binding-inefficiency">Binding Inefficiency</a></li></ul></li><li><a href="#worker-to-nodes-mapping">Worker to Nodes Mapping</a><ul class="toc-headings"><li><a href="#worker-mapping-implementation">Worker Mapping Implementation</a></li><li><a href="#configuration-parameters-1">Configuration Parameters</a></li><li><a href="#example-1">Example 1:</a></li><li><a href="#example-2">Example 2:</a></li><li><a href="#limitations">Limitations</a></li></ul></li><li><a href="#uniform-worker-mapping">Uniform Worker Mapping</a><ul class="toc-headings"><li><a href="#configuration-parameter">Configuration Parameter</a></li></ul></li><li><a href="#using-worker-mapping-and-binding-settings-together">Using Worker Mapping and Binding Settings Together</a></li><li><a href="#future-works">Future Works</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/docs/en/developing_twister2.html">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Indiana University</section></footer></div></body></html>