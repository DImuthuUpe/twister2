<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>architecture/resource-schedulers/mesos/twister2-on-mesos · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="**Twister2 On Mesos**"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="architecture/resource-schedulers/mesos/twister2-on-mesos · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/"/><meta property="og:description" content="**Twister2 On Mesos**"/><meta property="og:image" content="https://twister2.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Getting Started</a></li><li class=""><a href="/docs/compiling/compile_overview" target="_self">Docs</a></li><li class=""><a href="/docs/examples/tset/hello_world" target="_self">Tutorial</a></li><li class=""><a href="/docs/developers/debugging" target="_self">Contributors</a></li><li class=""><a href="/configs" target="_self">Configurations</a></li><li class=""><a href="/docs/download" target="_self">Download</a></li><li class=""><a href="https://github.com/DSC-SPIDAL/twister2" target="_blank">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">architecture/resource-schedulers/mesos/twister2-on-mesos</h1></header><article><div><span><p><strong>Twister2 On Mesos</strong></p>
<p>This document explains the design, features and implementations for
running Twister2 jobs on Mesos clusters. We designed and developed
components to run Twister2 workers and the Job Master in Mesos clusters.</p>
<p><strong>Mesos Overview</strong></p>
<p>Mesos is a fault tolerant cluster manager that provides resource
isolation and sharing across distributed applications or frameworks. It
schedules CPU and memory resources across the cluster in much the same
way the Linux Kernel schedules local resources. General Information
provided here about Mesos is taken from Apache Mesos web page.</p>
<p>The Mesos kernel runs on every machine and provides applications with
API's for resource management and scheduling across entire datacenter
and cloud environments. Mesos' two-level architecture allows it to run
existing and new distributed technologies on the same platform.  It can
scale up to 10000 nodes. It uses Zookeeper for fault tolerance.</p>
<p>Figure shows the main components of Mesos. As it can be seen in this
figure, there is a Mesos master and several Mesos agents. The master
enables fine-grained sharing of resources (CPU, RAM, ...) across
frameworks by making them resource offers. Each resource offer contains
a list of &lt;agent ID, resource1: amount1, resource2: amount2, ...&gt;.</p>
<p><img src="mesosarchitecture.png" alt="Mesos Architecture"></p>
<pre><code class="hljs">  Figure 1:Mesos Architecture\[mesos web page\]
</code></pre>
<p>You can find more details on
<a href="http://mesos.apache.org/documentation/latest/">http://mesos.apache.org/documentation/latest/</a></p>
<p>After installing Mesos master and clients you can use the following
methods to start and test them.</p>
<p><strong>Starting mesos-master</strong></p>
<pre><code class="hljs css language-bash">sudo service mesos-master start
</code></pre>
<p><strong>Starting mesos slaves</strong></p>
<pre><code class="hljs css language-bash">sudo service mesos-slave
</code></pre>
<p><strong>Checking if the services are running</strong></p>
<pre><code class="hljs css language-bash">systemctl status &lt;service_name&gt;  -l
</code></pre>
<pre><code class="hljs css language-text">example: systemctl status mesos-master -l
</code></pre>
<p><strong>Monitoring</strong></p>
<pre><code class="hljs css language-text">Mesos Master can be monitored on port 5050 of the machine it is installed.
</code></pre>
<p><strong>Mesos Framework</strong></p>
<p>The software that runs on top of a Mesos is called a framework. There
are two components of a framework that run on top of Mesos; a scheduler
and an executor. The scheduler registers with the master to get offer
resources. The executer runs on agent nodes to run framework's task.
While the master determines how many resources are offered to each
framework, the frameworks\' schedulers select which of the offered
resources to use. When a framework accepts offered resources, it passes
to Mesos a description of the tasks it wants to run on them. In turn,
Mesos launches the tasks on the corresponding agents.[ mesos web page]</p>
<p><img src="framework.png" alt="Mesos Framework"></p>
<pre><code class="hljs"> Figure 2: How a framework gets scheduled
</code></pre>
<p>This is what happens in figure 2[Mesos web page]:</p>
<ol>
<li><p>Agent 1 reports to the master that it has 4 CPUs and 4 GB of memory
free. The master then invokes the allocation policy module, which
tells it that framework 1 should be offered all available resources.</p></li>
<li><p>The master sends a resource offer describing what is available on
agent 1 to framework 1.</p></li>
<li><p>The framework's scheduler replies to the master with information
about two tasks to run on the agent, using &lt;2 CPUs, 1 GB RAM&gt; for
the first task, and &lt;1 CPUs, 2 GB RAM&gt; for the second task.</p></li>
<li><p>Finally, the master sends the tasks to the agent, which allocates
appropriate resources to the framework's executor, which in turn
launches the two tasks (depicted with dotted-line borders in the
figure). Because 1 CPU and 1 GB of RAM are still unallocated, the
allocation module may now offer them to framework 2.</p></li>
</ol>
<p><strong>Implementing Twister2 Jobs on Mesos</strong></p>
<p>Integration of Mesos and Twister2 provided a mechanism that Twister2
jobs can be run on Mesos. Creating a job on Twister2 can be done as
follows;</p>
<p>Necessary values are retrieved from the config file.</p>
<pre><code class="hljs css language-text">int cpus = MesosContext.cpusPerContainer(config);
int ramMegaBytes = MesosContext.ramPerContainer(config);
int diskMegaBytes = MesosContext.diskPerContainer(config);
int containers = MesosContext.numberOfContainers(config);
</code></pre>
<p>Then we create a ResourceContainer with these resources.</p>
<pre><code class="hljs css language-text">ResourceContainer resourceContainer = new ResourceContainer(cpus, ramMegaBytes, diskMegaBytes);
</code></pre>
<p>The we create the Job as follows;</p>
<pre><code class="hljs css language-text">BasicJob basicJob = BasicJob.newBuilder()
        .setName(jobName)
        .setContainerClass(containerClass)
        .setRequestResource(resourceContainer, containers)
        .setConfig(jobConfig)
        .build();
</code></pre>
<p>The last thing we do is to submit this job.</p>
<pre><code class="hljs css language-text">Twister2Submitter.submitContainerJob(basicJob, config);
</code></pre>
<p>In mesos, we can run more than one workers(tasks) in Executors. The choice
is left to the user and can be configured through configuration files.
Possible configuration options are;</p>
<ul>
<li><p><strong>One Worker per Executor:</strong> One workers will be run each Executor</p></li>
<li><p><strong>More Workers per Executor:</strong> Multiple workers can run in a single
Executor. The number of workers can be set in the configuration
file.</p></li>
</ul>
<!-- -->
```text
# container per mesos executor
twister2.container_per_worker: "1"
```
<p>Initialization of Executors are slower in Mesos. So running more workers
in executors will be a faster solution.</p>
<p><strong>Job Package</strong></p>
<p>Twister2 core package and job package are transferred to the node where
the Mesos master is running. Twister2 core package and the job package
will be transferred to each executors on agents over HTTP protocol.
Therefore, each executor needs the core and job package to be able to
run twister2 jobs.</p>
<p>When a client submits a job, job and core files uploaded to the machine
which serves as Mesos master. Then Mesos-executors and sandboxes are
created. Mesos has built-in fetcher (See
<a href="http://mesos.apache.org/documentation/latest/fetcher/">http://mesos.apache.org/documentation/latest/fetcher/</a>) to fetch resource
files to the sandbox. It supports HTTP, HTTPS, FTP and FTPS protocols.
To fetch twister2-core, job file into sandbox directory, upload
directory on the master must be shared via an HTTP server. After
fetching, Mesos unpacks these files, reads the job file and starts the
job.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/docs/en/concepts/api_overview">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Indiana University</section></footer></div></body></html>