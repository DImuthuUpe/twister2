<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>architecture/controller/worker-controller · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Worker Controller"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="architecture/controller/worker-controller · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/"/><meta property="og:description" content="# Worker Controller"/><meta property="og:image" content="https://twister2.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Getting Started</a></li><li class=""><a href="/docs/compiling/compile_overview" target="_self">Docs</a></li><li class=""><a href="/docs/examples/tset/hello_world" target="_self">Tutorial</a></li><li class=""><a href="/docs/examples/examples" target="_self">Examples</a></li><li class=""><a href="/docs/developers/debugging" target="_self">Contribute</a></li><li class=""><a href="/docs/download" target="_self">Download</a></li><li class=""><a href="/configs" target="_self">Configurations</a></li><li class=""><a href="https://github.com/DSC-SPIDAL/twister2" target="_blank">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">architecture/controller/worker-controller</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="worker-controller"></a><a href="#worker-controller" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Worker Controller</h1>
<p>We developed an interface: IWorkerController and provided its implementations by using various cluster services.
This interface provides the following services:</p>
<ul>
<li>Unique ID assignment to workers</li>
<li>Discovery of worker address and resource information in a job</li>
<li>Synchronizing workers using a barrier</li>
</ul>
<p><strong>Unique ID assignment to workers</strong>: We require that each worker in Twister2 jobs has a unique sequential ID starting from 0.
When N workers are started in a Twister2 job, the workers will have the unique IDs in the range of 0 to (N-1).</p>
<p><strong>Discovery of worker addresses and compute resources in a job</strong>:
We assume that each worker in a Twister2 job has a unique IP address and port number pair.
More than one worker may run on the same IP address, but they must have different port numbers.
So, each Twister2 worker in a job must have a unique ID and a unique IP:port pair.</p>
<p>When a Twister2 job is scheduled in a cluster, usually multiple Twister2 workers are started in that cluster.
All workers need to know the address of other workers in the job to be able to communicate with them.
In addition, workers in a job may have different compute resources such as CPU, RAM, and disk.
All workers need to know the compute resources of other workers.</p>
<p>The submitting client does not know where the workers will be started on the cluster, when it submits the job.
Therefore, it can not provide this information to the workers when they start.
Cluster resource schedulers start the workers in the nodes of the cluster.</p>
<p><strong>Node Location Information</strong>: Twister2 can use worker locations when scheduling tasks.
Workers may run in virtual machines such as pods in Kubernetes.
So, worker IP addresses can be different from the IP address of the physical node it is running on.
We provide a NodeInfo object for workers. It shows the physical node IP address for that worker.
The rack name of the node it is running on. And the datacenter name where this node is running.
Rack and datacenter names might not be available in all clusters.</p>
<p><strong>Synchronizing workers using a barrier</strong>: All workers in a Twister2 job may need to synchronize on a barrier point.
The workers that arrives earlier to the barrier point wait others to arrive.
When the last worker arrives to the barrier point, they are all released.</p>
<h2><a class="anchor" aria-hidden="true" id="iworkercontroller-interface"></a><a href="#iworkercontroller-interface" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IWorkerController Interface</h2>
<p>We designed an interface to be implemented by worker controllers and to be used by workers to discover other workers in a Twister job.</p>
<p>The interface is:</p>
<ul>
<li><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/common/src/java/edu/iu/dsc/tws/common/controller/IWorkerController.java">edu.iu.dsc.tws.common.controller.IWorkerController</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="iworkercontroller-implementations"></a><a href="#iworkercontroller-implementations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IWorkerController Implementations</h2>
<p>We developed worker controllers implementing IWorkerController interface using various cluster services.</p>
<h3><a class="anchor" aria-hidden="true" id="zookeeper-based-worker-controller"></a><a href="#zookeeper-based-worker-controller" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ZooKeeper Based Worker Controller</h3>
<p>We implemented a worker controller using a ZooKeeper server. ZooKeeper server runs in many clusters.
This worker controller can be used in those clusters. The worker controller class is:</p>
<ul>
<li><a href="https://github.com/DSC-SPIDAL/twister2/tree/d9edff9bac47239db44731064aa5e2ac98867d97/twister2/resource-scheduler/src/java/edu/iu/dsc/tws/rsched/bootstrap/ZKWorkerController.java">edu.iu.dsc.tws.rsched.bootstrap.ZKWorkerController</a></li>
</ul>
<p>Details of the implementation is provided in <a href="/docs/architecture/controller/zk-based-worker-controller">the document</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="job-master-based-worker-controller"></a><a href="#job-master-based-worker-controller" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Job Master Based Worker Controller</h3>
<p>Twister2 runs a Job Master in Twister2 jobs. We provide a Job Master based worker controller implementation. The worker controller class is:</p>
<ul>
<li><a href="https://github.com/DSC-SPIDAL/twister2/tree/d9edff9bac47239db44731064aa5e2ac98867d97/twister2/master/src/java/edu/iu/dsc/tws/master/client/JMWorkerController.java">edu.iu.dsc.tws.master.client.JMWorkerController</a></li>
</ul>
<p>Details of the implementation is provided in <a href="/docs/architecture/job-master/job-master">the document</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="kubernetes-master-based-worker-controller"></a><a href="#kubernetes-master-based-worker-controller" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubernetes Master Based Worker Controller</h3>
<p>We developed a worker controller that uses Kubernetes master to discover other workers in a Twister2 job.<br>
The worker controller class is:</p>
<ul>
<li><a href="https://github.com/DSC-SPIDAL/twister2/tree/d9edff9bac47239db44731064aa5e2ac98867d97/twister2/resource-scheduler/src/java/edu/iu/dsc/tws/rsched/schedulers/k8s/worker/K8sWorkerController.java">edu.iu.dsc.tws.rsched.schedulers.k8s.worker.K8sWorkerController</a></li>
</ul>
<p>Details of the implementation is provided in <a href="/docs/architecture/resource-schedulers/kubernetes/k8s-based-worker-discovery">the document</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="configuration-parameters"></a><a href="#configuration-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration Parameters</h2>
<p>We use followibg two configuration parameters to set the maximum wait times for worker controllers.</p>
<p>Following parameter determines the amount of time to wait for all workers to join the job, when getAllWorkers method is called.
Default value for this parameter is 100 seconds (100000).</p>
<pre><code class="hljs css language-text">twister2.worker.controller.max.wait.time.for.all.workers.to.join
</code></pre>
<p>Following parameter determines the amount of time to wait on a barrier for all workers to arrive, when waitOnBarrier is called.
Default value for this parameter is 100 seconds (100000).</p>
<pre><code class="hljs css language-text">twister2.worker.controller.max.wait.time.on.barrier
</code></pre>
<p>Both of these parameters can be found in system.yaml file.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#iworkercontroller-interface">IWorkerController Interface</a></li><li><a href="#iworkercontroller-implementations">IWorkerController Implementations</a><ul class="toc-headings"><li><a href="#zookeeper-based-worker-controller">ZooKeeper Based Worker Controller</a></li><li><a href="#job-master-based-worker-controller">Job Master Based Worker Controller</a></li><li><a href="#kubernetes-master-based-worker-controller">Kubernetes Master Based Worker Controller</a></li></ul></li><li><a href="#configuration-parameters">Configuration Parameters</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/docs/en/concepts/api_overview">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Indiana University</section></footer></div></body></html>