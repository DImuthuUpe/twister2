<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>architecture/job-master/job-master · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;job-master&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#job-master&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Job Master&lt;/h1&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="architecture/job-master/job-master · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/"/><meta property="og:description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;job-master&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#job-master&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Job Master&lt;/h1&gt;
"/><meta property="og:image" content="https://twister2.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Getting Started</a></li><li class=""><a href="/docs/compiling/compile_overview" target="_self">Docs</a></li><li class=""><a href="/docs/examples/tset/hello_world" target="_self">Tutorial</a></li><li class=""><a href="/docs/developers/debugging" target="_self">Contributors</a></li><li class=""><a href="/configs" target="_self">Configurations</a></li><li class=""><a href="/docs/download" target="_self">Download</a></li><li class=""><a href="https://github.com/DSC-SPIDAL/twister2" target="_blank">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">architecture/job-master/job-master</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="job-master"></a><a href="#job-master" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Job Master</h1>
<p>The Job Master manages job related activities during job execution such as worker life cycle management, worker discovery, resource cleanup, dynamic resource allocation, fault tolerance, etc.</p>
<p>Currently, we implemented the following services:</p>
<ol>
<li>Ping Service</li>
<li>Worker life-cycle monitoring</li>
<li>Worker Discovery</li>
<li>Job Termination</li>
<li>Barrier Service</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="possibilities-for-job-master-architecture"></a><a href="#possibilities-for-job-master-architecture" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Possibilities for Job Master Architecture</h2>
<p>There are three architectural alternatives for the design of the Job Master.</p>
<ol>
<li><strong>Long Running Singleton Job Master</strong>: A single Job master process may serve all Twister2 jobs in a cluster. It runs as a a long running service in a dedicated machine on the cluster. All jobs can be tracked by this single Job manager.
<ul>
<li>A disadvantage of this solution is that it puts too much pressure on a single process to manage all jobs.</li>
</ul></li>
<li><strong>Job submission client becomes the Job master</strong>: When a user submits a Twister2 job,
its process continues to run and become the job master. It means each job will have
a different job master.
<ul>
<li>One disadvantage might be that the job submitting client can not run outside of the cluster,
since all workers need to connect to the Job Master. Submitting client has to run in one of
the cluster machines.</li>
<li>Another disadvantage is that this solution is not really suitable for long running jobs.</li>
</ul></li>
<li><strong>A separate Job Master for each Job</strong>: Submitting client instantiates a separate Job master
for each job on a cluster machine.
<ul>
<li>This may increase the job initialization times, since the job master needs to be started as a separate entity for each job.</li>
<li>A separate entity is introduced to the system. This increases the overall complexity of Twister2 ecosystem.</li>
</ul></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="job-master-in-other-systems"></a><a href="#job-master-in-other-systems" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Job Master in Other Systems</h2>
<p><strong>Heron</strong>: Option 3 is implemented. One topology master is initiated for each job.</p>
<p><strong>Hadoop MapReduce v2</strong>: Option 3 is implemented. One ApplicationMaster is initiated for each job.</p>
<p><strong>Spark</strong>: Option 2 is implemented. SparkContext is initialized in the job submitting client. It acts as the job master.</p>
<p><strong>Flink</strong>: Option 1 is implemented. A single long running Job Manager schedules all jobs in a cluster. One Job Manager instance runs in one cluster.</p>
<h2><a class="anchor" aria-hidden="true" id="twister2-job-master-architecture"></a><a href="#twister2-job-master-architecture" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Twister2 Job Master Architecture</h2>
<p>We decided to choose the option 3 for the Job Master architecture. A separate Job master is started for each job. It runs in a cluster node. It is started when a job is submitted and deleted after the job has completed.</p>
<p>We also support the option 2. Submitting client can become the Job Master. With that option, our solution covers both the first and the second architectural options.</p>
<p>By default, Job Master is started as a separate process. If the user wants to start it in the submitting client, the value of the following configuration parameter needs to be set as true.</p>
<ul>
<li>twister2.job.master.runs.in.client</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="workers-to-job-master-communications"></a><a href="#workers-to-job-master-communications" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Workers to Job Master Communications</h2>
<p>We use protocol buffers to exchange messages between workers and the job master. We transfer the messages over TCP. All messages are in request-response semantics. All communications are initiated by workers. The job master only responds to requests.</p>
<h2><a class="anchor" aria-hidden="true" id="job-master-threading"></a><a href="#job-master-threading" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Job Master Threading</h2>
<p>Job Master is developed as a single threaded application. When a request message is received, a single thread is waken up. It processes the message and sends the response if needed. Then it starts to sleep and wait for the next message. It always starts to execute by worker request messages.</p>
<h2><a class="anchor" aria-hidden="true" id="ping-service"></a><a href="#ping-service" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ping Service</h2>
<p>When a worker starts, after it sends the worker STARTING message, it starts sending ping messages. Main client thread sends ping messages to the job master periodically. As long as the job master gets ping messages from a worker, it assumes that the worker is healthy. The job master gets the ping message, saves the ping time and sends a response message back to the worker.</p>
<p>Ping Message Format is shown below. It has the workerID from the sender worker. It also has the ping message and an optional string message for logging purposes.</p>
<pre><code class="hljs css language-text">message Ping {
    enum MessageType {
        WORKER_TO_MASTER = 0;
        MASTER_TO_WORKER = 1;
    }
    oneof idRequired {
        int32 workerID = 1;
    }
    oneof typeRequired {
        MessageType messageType = 2;
    }
    string pingMessage = 3;
}
</code></pre>
<p>Users can set the ping message sending intervals through configuration files. A default value is specified in the code, if they chose to not set it. Configuration parameter name is: twister2.worker.ping.interval</p>
<p>Ping service is started automatically. Users do not need to start it.</p>
<h2><a class="anchor" aria-hidden="true" id="worker-life-cycle-monitoring"></a><a href="#worker-life-cycle-monitoring" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Worker Life Cycle Monitoring</h2>
<p>Each worker reports its state changes to the job master during the job execution.
Currently we have the following states for workers:</p>
<pre><code class="hljs css language-text">enum WorkerState {
  STARTING = 0;
  RUNNING = 1;
  COMPLETED = 2;
  ERROR = 3;
  UNASSIGNED = 4;
}
</code></pre>
<p>When a worker is in the initializing phase, it first sends a STARTING message.
It sends its WorkerInfo message in this message. STARTING message registers the worker with the Job Master.
STARTING message is mandatory. It can not be omitted. After a request is received for the STARTING message,
the worker can send other messages. STARTING message is sent as a WorkerStateChange message.</p>
<pre><code class="hljs css language-text">message NodeInfo {
    string nodeIP = 1;
    string rackName = 2;
    string dataCenterName = 3;
}

message WorkerInfo {
    oneof required {
        int32 workerID = 1;
    }
    string workerIP = 2;
    int32 port = 3;

    NodeInfo nodeInfo = 4;
    tws.proto.job.ComputeResource computeResource = 5;
}

message WorkerStateChange {
    oneof idRequired {
        int32 workerID = 1;
    }
    oneof stateRequired {
        WorkerState newState = 2;
    }
    WorkerInfo workerInfo = 3;
}
</code></pre>
<p>After the worker completes initialization and ready to execute the user code, it sends RUNNING message.
When it has completed the computation, it sends COMPLETED message.</p>
<p>UNASSIGNED state is used in the program code to handle the initial state when no state information is present for a worker. UNASSIGNED message is not exchanged between the worker and the job master.</p>
<p>ERROR message is not currently used. We plan to use it to report error cases in the future.</p>
<p>Workers send WorkerStateChange message to the job master to inform it about its state change.
The format of the message is as follows:</p>
<p>WorkerInfo message defines the features of twister2 workers.</p>
<p>The job master in response sends the following message to the worker.</p>
<pre><code class="hljs css language-text">message WorkerStateChangeResponse {
    oneof idRequired {
        int32 workerID = 1;
    }
    oneof stateRequired {
        WorkerState sentState = 2;
    }
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="worker-discovery"></a><a href="#worker-discovery" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Worker Discovery</h2>
<p>Job Master provides worker discovery service to workers in a job. When a worker starts initializing,
it sends its WorkerInfo message to the job master. Job master keeps the list of all WorkerInfo messages
in a job with their state information.</p>
<p>Workers send ListWorkersRequest message to get the list of all workers in a job with their WorkerInfo data.
The message proto is shown below. Workers can get either the current list of joined workers from the job master,
or they can request the full list. In that case, the full list will be sent when all workers joined the job.
When they ask the current list, they get the list of joined workers immediately.
In both cases, this list includes the workers that have already left if any.</p>
<pre><code class="hljs css language-text">message ListWorkersRequest {
    enum RequestType {
        IMMEDIATE_RESPONSE = 0;
        RESPONSE_AFTER_ALL_JOINED = 1;
    }

    oneof idRequired {
        int32 workerID = 1;
    }
    oneof typeRequired {
        RequestType requestType = 2;
    }
}
</code></pre>
<p>Job master sends the worker list in the following message format.
It sends many worker information on the same message.</p>
<pre><code class="hljs css language-text">message ListWorkersResponse {

    oneof required {
        int32 workerID = 1;
    }
    repeated WorkerInfo worker = 2;
}
</code></pre>
<p><strong>IWorkerController Implementation</strong>  <br>
We developed the WorkerController class that will be used by the workers to interact with the job master.
The class name is:</p>
<pre><code class="hljs css language-text">edu.iu.dsc.tws.master.client.JMWorkerController
</code></pre>
<p>It implements the interface:</p>
<pre><code class="hljs css language-text">edu.iu.dsc.tws.common.controller.IWorkerController
</code></pre>
<p>All worker implementations can utilize this class for worker discovery.</p>
<h3><a class="anchor" aria-hidden="true" id="workerid-assignment"></a><a href="#workerid-assignment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WorkerID Assignment</h3>
<p>Each worker in a job should have a unique ID.
Worker IDs start from 0 and increase sequentially without any gaps in between.
Underlying Twister2 implementation must assign unique IDs for all workers.
When workers register with the Job Master, they must already have a valid unique ID.</p>
<h3><a class="anchor" aria-hidden="true" id="waiting-workers-on-a-barrier"></a><a href="#waiting-workers-on-a-barrier" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Waiting Workers on a Barrier</h3>
<p>Job Master implements the barrier mechanism by using a waitList. Each worker that comes to the barrier point sends the following BarrierRequest message to the Job Master.</p>
<pre><code class="hljs css language-text">message BarrierRequest {
    oneof required{
        int32 workerID = 1;
    }
}
</code></pre>
<p>Job Master puts the received request messages to the waitList. When it receives the BarrierRequest message from the last worker in the job, it sends the following response message to all workers:</p>
<pre><code class="hljs css language-text">message BarrierResponse {
    oneof required {
        int32 workerID = 1;
    }
}
</code></pre>
<p>When it sends the response messages to workers, it clears the waitList. Therefore, it can start a new barrier after all workers are released.</p>
<h2><a class="anchor" aria-hidden="true" id="job-termination"></a><a href="#job-termination" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Job Termination</h2>
<p>Job termination is handled differently in different cluster management systems such as Kubernetes and Mesos. Therefore, we designed an Interface to terminate jobs. This interface needs to be implemented on the relevant cluster management system. Then, an instance of this interface will be provided to the Job Master when it is initialized. Job Master calls the terminate method for a job after it receives worker COMPLETED messages from all workers in that job.</p>
<p>Job termination interface.</p>
<pre><code class="hljs css language-text">package edu.iu.dsc.tws.master;

public interface IJobTerminator {
  boolean terminateJob(String jobName);
}
</code></pre>
<p>An implementation of IJobTerminator for Kubernetes clusters can be found in:</p>
<ul>
<li>edu.iu.dsc.tws.rsched.schedulers.k8s.master.JobTerminator</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="usage"></a><a href="#usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Usage</h2>
<p>Job Master has two components:</p>
<pre><code class="hljs css language-text">edu.iu.dsc.tws.master.server.JobMaster
edu.iu.dsc.tws.master.client.JobMasterClient
</code></pre>
<p>JobMaster is the server that needs to be started for each job. JobMasterClient is the client that runs in workers and interacts with the server.</p>
<h3><a class="anchor" aria-hidden="true" id="jobmaster-usage"></a><a href="#jobmaster-usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JobMaster Usage</h3>
<p>JobMaster may be started locally to use in development testing. JobMaster needs to know the port number to serve, number of workers in the job, job name, a Job Terminator, etc. With these data, it can be started locally. If there is no need for Job Terminator, that may be null.</p>
<p>A sample usage is provided in the example class:</p>
<pre><code class="hljs css language-text">edu.iu.dsc.tws.examples.internal.jobmaster.JobMasterExample 
</code></pre>
<p>When Jobs are executed in resource schedulers such as in Kubernetes and Mesos, Job Master needs to be deployed in those systems. It is usually a good practice to write a separate JobMasterStarter class to start the job master in those environments. This starter class sets up the environment for the Job Master and starts it.</p>
<p>An example JobMasterStarter class is provided for Kubernetes cluster:</p>
<pre><code class="hljs css language-text">edu.iu.dsc.tws.rsched.schedulers.k8s.master.JobMasterStarter
</code></pre>
<p>It gets the required configuration parameters as environment variables and sets up the persistent storage and logging. Then, It starts the JobMaster.</p>
<h3><a class="anchor" aria-hidden="true" id="jobmasterclient-usage"></a><a href="#jobmasterclient-usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JobMasterClient Usage</h3>
<p>JobMasterClient class is used to send all supported messages to JobMaster server and receive the responses.</p>
<p>It is a single threaded class. Since it needs to periodically send Ping messages, it is developed as a Threaded application.</p>
<p>Some JobMasterClient methods are blocking calls. They wait until the response is received. Some other methods are non-blocking sends. They send the message, but do not wait for the response to proceed.</p>
<p>A sample usage is provided in the example class:</p>
<pre><code class="hljs css language-text">edu.iu.dsc.tws.examples.internal.jobmaster.JobMasterClientExample 
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="iworkercontroller-usage"></a><a href="#iworkercontroller-usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IWorkerController Usage</h3>
<p>JobMasterClient provides an implementation of IWorkerController interface. It is automatically initialized when a JobMasterClient is initialized. It can be accessed by the method:</p>
<pre><code class="hljs css language-text">public WorkerController getWorkerController()
</code></pre>
<p>A sample development usage of this client is given in the example class of JobMasterClientExample. Its usage in Kubernetes environments are provided in classes:</p>
<pre><code class="hljs css language-text">edu.iu.dsc.tws.rsched.schedulers.k8s.worker.K8sWorkerStarter
edu.iu.dsc.tws.rsched.schedulers.k8s.mpi.MPIWorkerStarter
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="configuration-parameters"></a><a href="#configuration-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration Parameters</h2>
<p>Job Master related configuraion parameters are handled by the class:</p>
<pre><code class="hljs css language-text">edu.iu.dsc.tws.master.JobMasterContext
</code></pre>
<p>Users can specify the following configuration parameters. Their names are default values are shown:</p>
<pre><code class="hljs css language-text">twister2.job.master.runs.in.client: false
twister2.job.master.cpu: 0.2
twister2.job.master.ram: 1024
twister2.job.master.volatile.volume.size: 1.0
twister2.job.master.persistent.volume.size: 1.0
twister2.job.master.port: 11011
twister2.worker.ping.interval: 10000
twister2.worker.to.job.master.response.wait.duration: 10000
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#possibilities-for-job-master-architecture">Possibilities for Job Master Architecture</a></li><li><a href="#job-master-in-other-systems">Job Master in Other Systems</a></li><li><a href="#twister2-job-master-architecture">Twister2 Job Master Architecture</a></li><li><a href="#workers-to-job-master-communications">Workers to Job Master Communications</a></li><li><a href="#job-master-threading">Job Master Threading</a></li><li><a href="#ping-service">Ping Service</a></li><li><a href="#worker-life-cycle-monitoring">Worker Life Cycle Monitoring</a></li><li><a href="#worker-discovery">Worker Discovery</a><ul class="toc-headings"><li><a href="#workerid-assignment">WorkerID Assignment</a></li><li><a href="#waiting-workers-on-a-barrier">Waiting Workers on a Barrier</a></li></ul></li><li><a href="#job-termination">Job Termination</a></li><li><a href="#usage">Usage</a><ul class="toc-headings"><li><a href="#jobmaster-usage">JobMaster Usage</a></li><li><a href="#jobmasterclient-usage">JobMasterClient Usage</a></li><li><a href="#iworkercontroller-usage">IWorkerController Usage</a></li></ul></li><li><a href="#configuration-parameters">Configuration Parameters</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/docs/en/concepts/api_overview">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Indiana University</section></footer></div></body></html>