<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Streaming Jobs · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Twister2 supports streaming jobs to be developed using two APIs."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Streaming Jobs · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/"/><meta property="og:description" content="Twister2 supports streaming jobs to be developed using two APIs."/><meta property="og:image" content="https://twister2.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Getting Started</a></li><li class="siteNavGroupActive"><a href="/docs/compiling/compile_overview" target="_self">Docs</a></li><li class=""><a href="/docs/examples/tset/hello_world" target="_self">Tutorial</a></li><li class=""><a href="/docs/examples/examples" target="_self">Examples</a></li><li class=""><a href="/docs/developers/debugging" target="_self">Contribute</a></li><li class=""><a href="/docs/download" target="_self">Download</a></li><li class=""><a href="/configs" target="_self">Configurations</a></li><li class=""><a href="https://github.com/DSC-SPIDAL/twister2" target="_blank">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>App Development</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Compiling</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/compiling/compile_overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/compiling/linux">Linux</a></li><li class="navListItem"><a class="navItem" href="/docs/compiling/macos">MacOS</a></li><li class="navListItem"><a class="navItem" href="/docs/compiling/generate-maven">Maven Artifacts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">App Development</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/concepts/api_overview">API Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/developing_twister2">Developing Applications</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/concepts/streaming_jobs">Streaming Jobs</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/batch_jobs">Batch Jobs</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">APIs</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/concepts/worker_api">Worker API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/tset_api">Data API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/task_api">Compute API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/op_api">Operator API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/windowing/windowing_api">Windowing API</a></li><li class="navListItem"><a class="navItem" href="/docs/compatibility/storm">Storm API</a></li><li class="navListItem"><a class="navItem" href="/docs/compatibility/apachebeam">Apache Beam</a></li><li class="navListItem"><a class="navItem" href="/docs/compatibility/pythonapi">Python API</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Deployment</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/deployment/job-submit">Job Submit</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/standalone/standalone">Standalone</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/docker/docker">Docker</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/kubernetes/Kubernetes">Kubernetes</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/minikube/Minikube">Minikube</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/mesos/mesos">Mesos</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/nomad/nomad">Nomad</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/slurm/slurm">Slurm</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/dashboard">Dashboard</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/logging">Logging</a></li><li class="navListItem"><a class="navItem" href="/docs/configurations/configurations">Configurations</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Concepts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/concepts/concepts">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/distributed_runtime">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/par_ops">Operators</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/task-system/concept_task">Task System</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/data-access/data_access">Data Access</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Resources</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/publications">Publications</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Streaming Jobs</h1></header><article><div><span><p>Twister2 supports streaming jobs to be developed using two APIs.</p>
<ol>
<li>Compute API</li>
<li>TSet API</li>
</ol>
<p>Compute API is similar to the Apache Storm API and TSet API is similar to the Apache Flink API.
Compute API is more versatile compared to the TSet API and streaming applications are natural fit for this API.
TSet API provides a typed API for streaming.</p>
<p>Streaming job is modeled as a graph which contains sources, computations and links. Every graph starts
with sources and can have multiple computations linked together. The links represent a communication (messaging)
between the sources, and computations.</p>
<p>A user programs an streaming applications by providing implementations of sources, computations and linking them
together using the communication mechanisms provided by the APIs.</p>
<p>Lets take the word count example, which is used as a hello world example in big data applications.</p>
<p><img src="/docs/assets/word_count.png" alt="Streaming Word Count"></p>
<p>In this example, set of sources read data from an incoming text stream. A hashed based routing is used to send
the words to a correct compute task. At this point a global count of a word can be calculated because each word goes to
its corresponding task every time.</p>
<h3><a class="anchor" aria-hidden="true" id="compute-api"></a><a href="#compute-api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Compute API</h3>
<p>Lets look at how this graph can be created and executed with Twister2 using the compute API.</p>
<pre><code class="hljs css language-java">    ComputeEnvironment cEnv = ComputeEnvironment.init(config, workerID,
        workerController, persistentVolume, volatileVolume);

    <span class="hljs-comment">// create source and aggregator</span>
    WordSource source = <span class="hljs-keyword">new</span> WordSource();
    WordAggregator counter = <span class="hljs-keyword">new</span> WordAggregator();

    <span class="hljs-comment">// build the graph</span>
    ComputeGraphBuilder builder = ComputeGraphBuilder.newBuilder(config);
    builder.addSource(<span class="hljs-string">"word-source"</span>, source, <span class="hljs-number">4</span>);
    builder.addCompute(<span class="hljs-string">"word-aggregator"</span>, counter, <span class="hljs-number">4</span>)
        .partition(<span class="hljs-string">"word-source"</span>)
        .viaEdge(<span class="hljs-string">"aggregate"</span>)
        .withDataType(MessageTypes.OBJECT);
    builder.setMode(OperationMode.STREAMING);

    <span class="hljs-comment">// build the graph</span>
    ComputeGraph graph = builder.build();
    <span class="hljs-comment">// execute graph</span>
    cEnv.getTaskExecutor().execute(graph);
</code></pre>
<p>Above is only the graph creation and execution part. Please refer to the full example in
<a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/streaming/wordcount/task/WordCountJob.java">word count</a> the source code for more details.</p>
<p>In the above example we create two tasks, one is the source task called <code>WordSource</code> and other is the
compute task called <code>WordAggregator</code>. These two tasks are added to <code>ComputeGraphBuilder</code> and connected by the partition edge (link).
The partition edge, by default uses hash of the message to select the destination of a message.</p>
<h3><a class="anchor" aria-hidden="true" id="tset-api"></a><a href="#tset-api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TSet API</h3>
<p>Here is the same example with the TSet API.This example can be found in the source
code <a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/streaming/wordcount/tset/WordCountJob.java">word count</a>.</p>
<pre><code class="hljs css language-java"> StreamingTSetEnvironment cEnv = TSetEnvironment.initStreaming(WorkerEnvironment.init(config,
        workerID, workerController, persistentVolume, volatileVolume));

  <span class="hljs-comment">// create source and aggregator</span>
  cEnv.createSource(<span class="hljs-keyword">new</span> SourceFunc&lt;String&gt;() {
    <span class="hljs-comment">// sample words</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; sampleWords = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-comment">// the random used to pick he words</span>
    <span class="hljs-keyword">private</span> Random random;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepare</span><span class="hljs-params">(TSetContext context)</span> </span>{
      <span class="hljs-keyword">this</span>.random = <span class="hljs-keyword">new</span> Random();
      RandomString randomString = <span class="hljs-keyword">new</span> RandomString(MAX_CHARS, random, RandomString.ALPHANUM);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; NO_OF_SAMPLE_WORDS; i++) {
        sampleWords.add(randomString.nextRandomSizeString());
      }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasNext</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">next</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">return</span> sampleWords.get(random.nextInt(sampleWords.size()));
    }
  }, <span class="hljs-number">4</span>).partition(<span class="hljs-keyword">new</span> HashingPartitioner&lt;&gt;()).sink(<span class="hljs-keyword">new</span> SinkFunc&lt;String&gt;() {
    <span class="hljs-comment">// keep track of the counts</span>
    <span class="hljs-keyword">private</span> Map&lt;String, Integer&gt; counts = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();

    <span class="hljs-keyword">private</span> TSetContext context;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepare</span><span class="hljs-params">(TSetContext context)</span> </span>{
      <span class="hljs-keyword">this</span>.context = context;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(String word)</span> </span>{
      <span class="hljs-keyword">int</span> count = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">if</span> (counts.containsKey(word)) {
        count = counts.get(word);
        count++;
      }
      counts.put(word, count);
      LOG.log(Level.INFO, String.format(<span class="hljs-string">"%d Word %s count %s"</span>, context.getIndex(),
          word, count));
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
  });
  
  <span class="hljs-comment">// start executing the streaming graph</span>
  cEnv.run();
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="streaming-operators"></a><a href="#streaming-operators" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Streaming Operators</h3>
<p>Twister2 supports following streaming operations. More information of these operations can be found
int <a href="/docs/concepts/task_api">compute API</a>.</p>
<table>
<thead>
<tr><th style="text-align:left">Operations</th><th style="text-align:left">Description</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left">Direct</td><td style="text-align:left">A one to one mapping from a task to to another</td></tr>
<tr><td style="text-align:left">Reduce</td><td style="text-align:left">Reduce values from N tasks to a single task</td></tr>
<tr><td style="text-align:left">AllReduce</td><td style="text-align:left">Reduce values from N tasks and distributes to M tasks</td></tr>
<tr><td style="text-align:left">Gather</td><td style="text-align:left">Gathers values from N tasks to a single task</td></tr>
<tr><td style="text-align:left">AllGather</td><td style="text-align:left">Gathers values from N tasks and distributes to M tasks</td></tr>
<tr><td style="text-align:left">Broadcast</td><td style="text-align:left">Broadcast a value from 1 task to N tasks</td></tr>
<tr><td style="text-align:left">Partition</td><td style="text-align:left">All to all operation that sends values from N tasks to M tasks</td></tr>
<tr><td style="text-align:left">Keyed-Partition</td><td style="text-align:left">All to all operation that sends values from N tasks to M tasks according to a key</td></tr>
</tbody>
</table>
<pre><code class="hljs"></code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/guides/developing_twister2"><span class="arrow-prev">← </span><span>Developing Applications</span></a><a class="docs-next button" href="/docs/concepts/batch_jobs"><span>Batch Jobs</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/docs/en/concepts/api_overview">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Indiana University</section></footer></div></body></html>