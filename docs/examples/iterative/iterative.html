<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Iterative · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The iterative task graph computation is mainly useful to perform the iterative computation process "/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Iterative · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/"/><meta property="og:description" content="The iterative task graph computation is mainly useful to perform the iterative computation process "/><meta property="og:image" content="https://twister2.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Getting Started</a></li><li class=""><a href="/docs/compiling/compile_overview" target="_self">Docs</a></li><li class=""><a href="/docs/examples/tset/hello_world" target="_self">Tutorial</a></li><li class=""><a href="/docs/examples/examples" target="_self">Examples</a></li><li class=""><a href="/docs/developers/debugging" target="_self">Contribute</a></li><li class=""><a href="/docs/download" target="_self">Download</a></li><li class=""><a href="/configs" target="_self">Configurations</a></li><li class=""><a href="/javadocs/index.html" target="_self">Java Docs</a></li><li class=""><a href="https://github.com/DSC-SPIDAL/twister2" target="_blank">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Iterative</h1></header><article><div><span><p>The iterative task graph computation is mainly useful to perform the iterative computation process
in the big data world. It generally captures the complex relationship between the entities. In this
example, we discuss about how to write an iterative example using Twister2 Executor API. Here we
have a SourceTask which is just doing the generation of data and it is named as IterativeSourceTask
and the SinkTask which receives the messages is named as the ParitionTask.</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IterativeSourceTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseBatchSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Receptor</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">254264120110286748L</span>;

    <span class="hljs-keyword">private</span> DataSet&lt;Object&gt; input;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">if</span> (count == <span class="hljs-number">999</span>) {
        <span class="hljs-keyword">if</span> (context.writeEnd(<span class="hljs-string">"partition"</span>, <span class="hljs-string">"Hello"</span>)) {
          count++;
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">999</span>) {
        <span class="hljs-keyword">if</span> (context.write(<span class="hljs-string">"partition"</span>, <span class="hljs-string">"Hello"</span>)) {
          count++;
        }
      }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(String name, DataSet&lt;Object&gt; data)</span> </span>{
      LOG.log(Level.INFO, <span class="hljs-string">"Received input: "</span> + name);
      input = data;
    }
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PartitionTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseBatchSink</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Collector</span>&lt;<span class="hljs-title">Object</span>&gt; </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">5190777711234234L</span>;

    <span class="hljs-keyword">private</span> List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">execute</span><span class="hljs-params">(IMessage message)</span> </span>{
      LOG.log(Level.INFO, <span class="hljs-string">"Received message: "</span> + message.getContent());

      <span class="hljs-keyword">if</span> (message.getContent() <span class="hljs-keyword">instanceof</span> Iterator) {
        <span class="hljs-keyword">while</span> (((Iterator) message.getContent()).hasNext()) {
          Object ret = ((Iterator) message.getContent()).next();
          count++;
          list.add(ret.toString());
        }
        LOG.info(<span class="hljs-string">"Message Partition Received : "</span> + message.getContent() + <span class="hljs-string">", Count : "</span> + count);
      }
      count++;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Partition&lt;Object&gt; <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Partition&lt;&gt;(context.taskIndex(), list);
    }
  }
</code></pre>
<p>The iterative logic is defined in the executor method. Here there are 10 iterations
which calls the execute method in the task execution graph.</p>
<pre><code class="hljs css language-java">
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> </span>{
    LOG.log(Level.INFO, <span class="hljs-string">"Task worker starting: "</span> + workerId);

    IterativeSourceTask g = <span class="hljs-keyword">new</span> IterativeSourceTask();
    PartitionTask r = <span class="hljs-keyword">new</span> PartitionTask();

    TaskGraphBuilder graphBuilder = TaskGraphBuilder.newBuilder(config);
    graphBuilder.addSource(<span class="hljs-string">"source"</span>, g, <span class="hljs-number">4</span>);
    ComputeConnection computeConnection = graphBuilder.addSink(<span class="hljs-string">"sink"</span>, r, <span class="hljs-number">4</span>);
    computeConnection.partition(<span class="hljs-string">"source"</span>, <span class="hljs-string">"partition"</span>, DataType.OBJECT);
    graphBuilder.setMode(OperationMode.BATCH);

    DataFlowTaskGraph graph = graphBuilder.build();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
      ExecutionPlan plan = taskExecutor.plan(graph);
      taskExecutor.addInput(graph, plan, <span class="hljs-string">"source"</span>, <span class="hljs-string">"input"</span>, <span class="hljs-keyword">new</span> DataSet&lt;&gt;(<span class="hljs-number">0</span>));

      <span class="hljs-comment">// this is a blocking call</span>
      taskExecutor.execute(graph, plan);
      DataSet&lt;Object&gt; dataSet = taskExecutor.getOutput(graph, plan, <span class="hljs-string">"sink"</span>);
      Set&lt;Object&gt; values = dataSet.getData();
      LOG.log(Level.INFO, <span class="hljs-string">"Values: "</span> + values);
    }
  }

</code></pre>
<h3><a class="anchor" aria-hidden="true" id="to-run-iterative-task-graph-example"></a><a href="#to-run-iterative-task-graph-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>To Run Iterative Task Graph Example</h3>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.task.batch.IterativeJob
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/task/batch/IterativeJob.java">Iterative Task Graph Source Code</a></p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/docs/en/concepts/api_overview">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2020 Indiana University</section></footer></div></body></html>