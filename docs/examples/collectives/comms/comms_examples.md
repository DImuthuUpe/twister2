# Communication Examples

Communication examples demonstrate the usage of communication API. 
The communication api has the capability of creating the communication among the
tasks by abstracting the communication logic to the api users. 
Basically, the communication layer does the job of creating the communication of the tasks in the 
task graph based on the user description. Communication api supports a simple thread model
to spawn the processes to run the the tasks using built communication. The
communication logic is visible to the users when the communication API is used.
Twister2 has the modular structure for supporting the developer's need. They can 
plug in the Twister2:Net to support the communication in the projects without using
the other layers in Twister2. In the communication examples we demonstrate how to 
create the following collective communications. 

## Twister2 Collective Communications

1. Reduce
2. Allreduce
3. Gather
4. AllGather
5. KeyedReduce
6. KeyedGather
7. Broadcast
8. Partition
9. KeyedPartition

After building the project, you can run the batch mode examples as follows. 

```bash
./twister2-dist/bin/twister2 submit standalone jar twister2-dist/examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -itr <iterations> -workers <workers> -size <data_size> -op "<operation>" -stages <source_parallelsim>,<sink_parallelism> -<flag> -verify
```

### Running Option Definitions

1. itr : integer number which provides the number of iterations which the application must run
2. workers : Number of workers needed for the application
3. data_size : size of the array that is being passed. In the examples, we generate an array specified by this size
4. op : Collective operation type:
    1. reduce
    2. allreduce
    3. gather
    4. allgather
    5. keyed-reduce
    6. keyed-gather
    7. bcast
    8. partition
    9. keyed-partition
5. stages : has to params 
    1. source_parallelism : depending on the collective communication that you prefer select this number
    2. sink_parallelism : depending on the collective communication that you prefer select this number
    Example : For reduce communication it can be 4,1 as sink has to be a single point of receive in the reduction 
    process and source has more data generating points. 
6. flag : for a batch job this flag must be empty, if it is an streaming job, -stream would state the flag. 
7. verify : -verify flag does the verification of the collective operation. This is an optional parameter. 


## Batch Examples

### Reduce Example

In the reduction operation, we need specify which kind of mathematical operation that
we are expecting to run, in this case the summation is considered for a integer data set
generated by the program itself. In the following code snippet, the reduction based 
communication is built based on the user inputs when running the application. 

```java
    reduce = new BReduce(communicator, taskPlan, sources, target,
        new ReduceOperationFunction(Op.SUM, MessageType.INTEGER), new FinalSingularReceiver(),
        MessageType.INTEGER);
```

Running a reduction operation on a size of 8 array with 4 workers iterating once with source parallelism of 8
and sink parallelism of 1, added with result verification. 

```bash
./twister2-dist/bin/twister2 submit standalone jar twister2-dist/examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExamplekMain -itr 1 -workers 4 -size 8 -op "reduce" -stages 8,1 -verify

```
[Communication based Batch Reduce Source Code](https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/comms/batch/BReduceExample.java)



