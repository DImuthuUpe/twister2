<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Multistage · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Multistage Example"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Multistage · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/"/><meta property="og:description" content="## Multistage Example"/><meta property="og:image" content="https://twister2.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Getting Started</a></li><li class=""><a href="/docs/compiling/compile_overview" target="_self">Docs</a></li><li class=""><a href="/docs/examples/tset/hello_world" target="_self">Tutorial</a></li><li class=""><a href="/docs/developers/debugging" target="_self">Contributors</a></li><li class=""><a href="/configs" target="_self">Configurations</a></li><li class=""><a href="/docs/download" target="_self">Download</a></li><li class=""><a href="https://github.com/DSC-SPIDAL/twister2" target="_blank">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Multistage</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="multistage-example"></a><a href="#multistage-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Multistage Example</h2>
<p>Multistage example refers to one or more intermediate tasks between the source and sink
task.</p>
<h2><a class="anchor" aria-hidden="true" id="batch-tasks"></a><a href="#batch-tasks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Batch Tasks</h2>
<pre><code class="hljs css language-java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GeneratorTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseStreamSource</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">254264903510284748L</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">if</span> (count == <span class="hljs-number">999</span>) {
        <span class="hljs-keyword">if</span> (context.writeEnd(<span class="hljs-string">"partition-edge"</span>, <span class="hljs-string">"Hello"</span>)) {
          count++;
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">999</span>) {
        <span class="hljs-keyword">if</span> (context.write(<span class="hljs-string">"partition-edge"</span>, <span class="hljs-string">"Hello"</span>)) {
          count++;
        }
      }
    }
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReduceTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseStreamSink</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">254264903510284791L</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">execute</span><span class="hljs-params">(IMessage message)</span> </span>{
      count++;
      LOG.info(String.format(<span class="hljs-string">"%d %d Reduce received count: %d"</span>, context.getWorkerId(),
          context.taskId(), count));
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
  }

  <span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"rawtypes"</span>)
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PartitionTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseStreamCompute</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">254264903510284798L</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">execute</span><span class="hljs-params">(IMessage message)</span> </span>{
      <span class="hljs-keyword">if</span> (message.getContent() <span class="hljs-keyword">instanceof</span> Iterator) {
        Iterator it = (Iterator) message.getContent();
        <span class="hljs-keyword">while</span> (it.hasNext()) {
          count += <span class="hljs-number">1</span>;
          context.write(<span class="hljs-string">"compute-edge"</span>, it.next());
        }
      }
      LOG.info(String.format(<span class="hljs-string">"%d %d Partition Received count: %d"</span>, context.getWorkerId(),
          context.taskId(), count));
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
  }
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="stream-task"></a><a href="#stream-task" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stream Task</h2>
<pre><code class="hljs css language-java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GeneratorTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseStreamSource</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">254264903510284748L</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">if</span> (count == <span class="hljs-number">999</span>) {
        <span class="hljs-keyword">if</span> (context.writeEnd(<span class="hljs-string">"partition-edge"</span>, <span class="hljs-string">"Hello"</span>)) {
          count++;
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">999</span>) {
        <span class="hljs-keyword">if</span> (context.write(<span class="hljs-string">"partition-edge"</span>, <span class="hljs-string">"Hello"</span>)) {
          count++;
        }
      }
    }
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReduceTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseStreamSink</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">254264903510284791L</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">execute</span><span class="hljs-params">(IMessage message)</span> </span>{
      count++;
      LOG.info(String.format(<span class="hljs-string">"%d %d Reduce received count: %d"</span>, context.getWorkerId(),
          context.taskId(), count));
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
  }

  <span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"rawtypes"</span>)
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PartitionTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseStreamCompute</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">254264903510284798L</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">execute</span><span class="hljs-params">(IMessage message)</span> </span>{
      <span class="hljs-keyword">if</span> (message.getContent() <span class="hljs-keyword">instanceof</span> Iterator) {
        Iterator it = (Iterator) message.getContent();
        <span class="hljs-keyword">while</span> (it.hasNext()) {
          count += <span class="hljs-number">1</span>;
          context.write(<span class="hljs-string">"compute-edge"</span>, it.next());
        }
      }
      LOG.info(String.format(<span class="hljs-string">"%d %d Partition Received count: %d"</span>, context.getWorkerId(),
          context.taskId(), count));
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
  }

</code></pre>
<p>In the multistage example we have a source task, two compute tasks which extends the BaseCompute
class. There can be multiple compute tasks depending on the description of the task. In this one we
generate a stream of data in the source task and in the intermediate task the partition
is done and in the final task we do a reduction operation.</p>
<pre><code class="hljs css language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> </span>{
    GeneratorTask g = <span class="hljs-keyword">new</span> GeneratorTask();
    ReduceTask rt = <span class="hljs-keyword">new</span> ReduceTask();
    PartitionTask r = <span class="hljs-keyword">new</span> PartitionTask();

    TaskGraphBuilder builder = TaskGraphBuilder.newBuilder(config);
    builder.addSource(<span class="hljs-string">"source"</span>, g, <span class="hljs-number">4</span>);
    ComputeConnection pc = builder.addCompute(<span class="hljs-string">"compute"</span>, r, <span class="hljs-number">4</span>);
    pc.partition(<span class="hljs-string">"source"</span>, <span class="hljs-string">"partition-edge"</span>, DataType.OBJECT);
    ComputeConnection rc = builder.addCompute(<span class="hljs-string">"sink"</span>, rt, <span class="hljs-number">1</span>);
    rc.reduce(<span class="hljs-string">"compute"</span>, <span class="hljs-string">"compute-edge"</span>, <span class="hljs-keyword">new</span> IFunction() {
      <span class="hljs-meta">@Override</span>
      <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">onMessage</span><span class="hljs-params">(Object object1, Object object2)</span> </span>{
        <span class="hljs-keyword">return</span> object1;
      }
    });
    builder.setMode(OperationMode.STREAMING);

    DataFlowTaskGraph graph = builder.build();
    TaskUtils.execute(config, allocatedResources, graph, workerController);
  }
</code></pre>
<p>Here the ComputeConnection class calls the reduce function to reduce the data via the compute
task to the sink task.</p>
<p>Run the following command to run this example.</p>
<h2><a class="anchor" aria-hidden="true" id="to-run-multistage-batch-example"></a><a href="#to-run-multistage-batch-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>To run Multistage Batch Example</h2>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.task.batch.MultiStageGraph
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/task/batch/MultiStageGraph.java">MultiStage TaskGraph Batch Source Code</a></p>
<h2><a class="anchor" aria-hidden="true" id="to-run-multistage-streaming-example"></a><a href="#to-run-multistage-streaming-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>To run Multistage Streaming Example</h2>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.task.streaming.MultiStageGraph
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/task/streaming/MultiStageGraph.java">MultiStage TaskGraph Streaming Source Code</a></p>
<h2><a class="anchor" aria-hidden="true" id="multiple-compute-tasks-example"></a><a href="#multiple-compute-tasks-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Multiple Compute Tasks Example</h2>
<p>The multiple compute tasks consists of a source node and sends output to multiple compute dataflow
nodes. Also, the final compute task receive the input from multiple compute dataflow nodes.</p>
<p>The structure of the graph is given below:</p>
<pre><code class="hljs css language-text">    Source (Task 1)
       |
       |
       V
  Task2  Task3 (Multiple Compute Elements)
    |     |
    |     |
    V     V
  Target (Task 4)
</code></pre>
<p><img src="/docs/assets/multicompute_taskgraph.png" alt="MultiComputeNodes Task Graph"></p>
<h3><a class="anchor" aria-hidden="true" id="multiple-compute-tasks-example-1"></a><a href="#multiple-compute-tasks-example-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Multiple Compute Tasks Example</h3>
<p>This example is described in four stages namely</p>
<ol>
<li>defining the task graph</li>
<li>creating the compute connections</li>
<li>creating the communication edges between the compute connections</li>
<li>build and execute the task graph</li>
</ol>
<pre><code class="hljs css language-java">    SourceTask sourceTask = <span class="hljs-keyword">new</span> SourceTask();
    FirstComputeTask firstComputeTask = <span class="hljs-keyword">new</span> FirstComputeTask();
    SecondComputeTask secondComputeTask = <span class="hljs-keyword">new</span> SecondComputeTask();
    ReduceTask reduceTask = <span class="hljs-keyword">new</span> ReduceTask();
</code></pre>
<pre><code class="hljs css language-java">    builder.addSource(<span class="hljs-string">"source"</span>, sourceTask, parallel);
       ComputeConnection firstComputeConnection = builder.addCompute(
           <span class="hljs-string">"firstcompute"</span>, firstComputeTask, parallel);
       ComputeConnection secondComputeConnection = builder.addCompute(
           <span class="hljs-string">"secondcompute"</span>, secondComputeTask, parallel);
       ComputeConnection reduceConnection = builder.addCompute(<span class="hljs-string">"compute"</span>, reduceTask, parallel);
</code></pre>
<p>The source task creates the direct communication edge beween the first compute and second compute
task. From the first compute and second compute, it creates an all-reduce communication edge to
the reduce task.</p>
<pre><code class="hljs css language-java">    firstComputeConnection.direct(<span class="hljs-string">"source"</span>, <span class="hljs-string">"fdirect"</span>, DataType.OBJECT);
    secondComputeConnection.direct(<span class="hljs-string">"source"</span>, <span class="hljs-string">"sdirect"</span>, DataType.OBJECT);
    reduceConnection.allreduce(<span class="hljs-string">"firstcompute"</span>, <span class="hljs-string">"freduce"</span>, <span class="hljs-keyword">new</span> Aggregator(), DataType.OBJECT);
    reduceConnection.allreduce(<span class="hljs-string">"secondcompute"</span>, <span class="hljs-string">"sreduce"</span>, <span class="hljs-keyword">new</span> Aggregator(), DataType.OBJECT);
</code></pre>
<p>This build and generate the task graph for the batch process. Then, it call the taskscheduler and
taskexecutor to build the task schedule plan and execution plan respectively. Finally, it calls
the execute method to execute the generated task graph.</p>
<pre><code class="hljs css language-java">    builder.setMode(OperationMode.BATCH);
    DataFlowTaskGraph graph = builder.build();
    ExecutionPlan plan = taskExecutor.plan(graph);
    taskExecutor.execute(graph, plan);
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="to-run-multiple-compute-tasks-example"></a><a href="#to-run-multiple-compute-tasks-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>To Run Multiple Compute Tasks Example</h2>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.internal.taskgraph.MultiComputeTasksGraphExample -dsize 100 -parallelism 2 -workers 2 -dim 2 -csize 4 -dinput /tmp/dinput -cinput /tmp/dinput -filesys <span class="hljs-built_in">local</span> -nFiles 1
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/internal/taskgraph/MultiComputeTasksGraphExample.java">Multiple Compute Tasks Source Code</a></p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#multistage-example">Multistage Example</a></li><li><a href="#batch-tasks">Batch Tasks</a></li><li><a href="#stream-task">Stream Task</a></li><li><a href="#to-run-multistage-batch-example">To run Multistage Batch Example</a></li><li><a href="#to-run-multistage-streaming-example">To run Multistage Streaming Example</a></li><li><a href="#multiple-compute-tasks-example">Multiple Compute Tasks Example</a><ul class="toc-headings"><li><a href="#multiple-compute-tasks-example-1">Multiple Compute Tasks Example</a></li></ul></li><li><a href="#to-run-multiple-compute-tasks-example">To Run Multiple Compute Tasks Example</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/docs/en/concepts/api_overview">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Indiana University</section></footer></div></body></html>